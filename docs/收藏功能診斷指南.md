# æ”¶è—åŠŸèƒ½è¨ºæ–·æŒ‡å—

## ğŸ” å•é¡Œè¨ºæ–·æ­¥é©Ÿ

### 1. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°

**æ“ä½œæ­¥é©Ÿï¼š**
1. æ‰“é–‹æ¼«ç•« Reader é é¢
2. æŒ‰ `F12` æ‰“é–‹é–‹ç™¼è€…å·¥å…·
3. åˆ‡æ›åˆ° **Consoleï¼ˆæ§åˆ¶å°ï¼‰** æ¨™ç±¤
4. é»æ“Šæ˜Ÿæ˜ŸæŒ‰éˆ•
5. æŸ¥çœ‹æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯

**é æœŸè¼¸å‡ºï¼š**
- æ‡‰è©²çœ‹åˆ° API è«‹æ±‚
- æ²’æœ‰ç´…è‰²éŒ¯èª¤è¨Šæ¯

**å¸¸è¦‹éŒ¯èª¤ï¼š**
```javascript
// å¦‚æœçœ‹åˆ°é€™äº›éŒ¯èª¤ï¼š
âŒ 404 Not Found - API è·¯ç”±æœªæ­£ç¢ºè¨»å†Š
âŒ 500 Internal Server Error - å¾Œç«¯ä»£ç¢¼éŒ¯èª¤
âŒ CORS Error - è·¨åŸŸå•é¡Œ
âŒ TypeError - JavaScript ä»£ç¢¼éŒ¯èª¤
```

### 2. æª¢æŸ¥ç¶²è·¯è«‹æ±‚

**æ“ä½œæ­¥é©Ÿï¼š**
1. åœ¨é–‹ç™¼è€…å·¥å…·ä¸­åˆ‡æ›åˆ° **Networkï¼ˆç¶²è·¯ï¼‰** æ¨™ç±¤
2. å‹¾é¸ **Preserve logï¼ˆä¿ç•™æ—¥èªŒï¼‰**
3. é»æ“Šæ˜Ÿæ˜ŸæŒ‰éˆ•
4. æŸ¥çœ‹ç™¼é€çš„è«‹æ±‚

**é æœŸè«‹æ±‚ï¼š**
```
1. GET /manga/api/status/æ¼«ç•«åç¨±
   Status: 200 OK
   Response: {"status": "reviewed", "path": "æ¼«ç•«åç¨±"}

2. POST /manga/api/status/æ¼«ç•«åç¨±
   Status: 200 OK
   Request Body: {"status": "favorite"}
   Response: {"status": "favorite", "path": "æ¼«ç•«åç¨±"}
```

### 3. æª¢æŸ¥ navigation ç‰©ä»¶

**åœ¨æ§åˆ¶å°åŸ·è¡Œï¼š**
```javascript
console.log(window.reader.navigation);
```

**é æœŸè¼¸å‡ºï¼š**
```javascript
{
  manga_name: "æ¼«ç•«åç¨±",
  current_chapter: {...},
  prev: {...},
  next: {...}
}
```

**å¦‚æœ manga_name ç‚ºç©ºæˆ– undefinedï¼š**
- é€™æ˜¯å•é¡Œçš„æ ¹æº
- API è«‹æ±‚ç„¡æ³•åŸ·è¡Œ

### 4. æ‰‹å‹•æ¸¬è©¦ API

**ä½¿ç”¨ PowerShell æ¸¬è©¦ï¼š**

```powershell
# æ¸¬è©¦ç²å–ç‹€æ…‹ï¼ˆæ›¿æ› "æ¸¬è©¦æ¼«ç•«" ç‚ºå¯¦éš›æ¼«ç•«åç¨±ï¼‰
$mangaName = "æ¸¬è©¦æ¼«ç•«"
$encodedName = [System.Web.HttpUtility]::UrlEncode($mangaName)
Invoke-RestMethod -Uri "http://127.0.0.1:5000/manga/api/status/$encodedName"

# æ¸¬è©¦è¨­ç½®æ”¶è—
$body = @{ status = "favorite" } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/manga/api/status/$encodedName" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body
```

### 5. æª¢æŸ¥æœå‹™å™¨æ—¥èªŒ

**æŸ¥çœ‹çµ‚ç«¯è¼¸å‡ºï¼š**
- é»æ“Šæ˜Ÿæ˜Ÿå¾Œï¼Œçµ‚ç«¯æ‡‰è©²é¡¯ç¤º API è«‹æ±‚
- æŸ¥æ‰¾æ˜¯å¦æœ‰ Python éŒ¯èª¤å †æ£§

**å¸¸è¦‹å¾Œç«¯éŒ¯èª¤ï¼š**
```python
âŒ KeyError: 'manga_name' - navigation æ•¸æ“šç¼ºå¤±
âŒ FileNotFoundError - status.json ä¸å­˜åœ¨æˆ–ç„¡æ¬Šé™
âŒ JSONDecodeError - JSON æ ¼å¼éŒ¯èª¤
```

## ğŸ› ï¸ å¸¸è¦‹å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1: navigation.manga_name ç‚º undefined

**è¨ºæ–·ï¼š**
```javascript
// åœ¨æ§åˆ¶å°åŸ·è¡Œ
console.log(window.reader.navigation);
// å¦‚æœ manga_name ä¸å­˜åœ¨
```

**åŸå› ï¼š**
- å¾Œç«¯æ²’æœ‰è¿”å› manga_name
- è·¯ç”±è§£æéŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆï¼š**
æª¢æŸ¥ `src/modules/manga/service.py` çš„ `get_chapter_navigation()` æ–¹æ³•

### å•é¡Œ 2: API è¿”å› 404

**ç—‡ç‹€ï¼š**
```
GET http://127.0.0.1:5000/manga/api/status/xxx 404 (Not Found)
```

**åŸå› ï¼š**
- è·¯ç”±æœªæ­£ç¢ºè¨»å†Š
- Blueprint æœªè¼‰å…¥

**è§£æ±ºæ–¹æ¡ˆï¼š**
```powershell
# é‡å•Ÿæœå‹™å™¨
# åœ¨çµ‚ç«¯æŒ‰ Ctrl+C åœæ­¢
# ç„¶å¾Œé‡æ–°å•Ÿå‹•
cd src
python app.py
```

### å•é¡Œ 3: API è¿”å› 500

**ç—‡ç‹€ï¼š**
```
POST http://127.0.0.1:5000/manga/api/status/xxx 500 (Internal Server Error)
```

**åŸå› ï¼š**
- StatusManager åˆå§‹åŒ–å¤±æ•—
- JSON æ–‡ä»¶æ¬Šé™å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆï¼š**
```powershell
# æª¢æŸ¥æ–‡ä»¶æ¬Šé™
Get-Acl data\status.json

# åˆªé™¤ä¸¦é‡å»º
Remove-Item data\status.json
# é‡å•Ÿæœå‹™å™¨æœƒè‡ªå‹•å‰µå»º
```

### å•é¡Œ 4: æ˜Ÿæ˜ŸæŒ‰éˆ•ç„¡åæ‡‰

**ç—‡ç‹€ï¼š**
- é»æ“Šæ˜Ÿæ˜Ÿæ²’æœ‰ä»»ä½•åæ‡‰
- æ§åˆ¶å°ç„¡éŒ¯èª¤

**åŸå› ï¼š**
- toggleFavorite å‡½æ•¸æœªç¶å®š
- favoriteBtn å…ƒç´ æœªæ‰¾åˆ°

**è¨ºæ–·ï¼š**
```javascript
// åœ¨æ§åˆ¶å°åŸ·è¡Œ
console.log(document.getElementById('favoriteBtn'));
console.log(typeof toggleFavorite);
```

**è§£æ±ºæ–¹æ¡ˆï¼š**
æ¸…é™¤ç€è¦½å™¨å¿«å–ä¸¦é‡æ–°æ•´ç†ï¼š
```
Ctrl + Shift + Delete
æˆ–
Ctrl + F5 (å¼·åˆ¶é‡æ–°æ•´ç†)
```

### å•é¡Œ 5: JSON æ–‡ä»¶æ²’æœ‰æ›´æ–°

**ç—‡ç‹€ï¼š**
- API è«‹æ±‚æˆåŠŸï¼ˆ200 OKï¼‰
- ä½† status.json å…§å®¹ä¸è®Š

**åŸå› ï¼š**
- æ–‡ä»¶è¢«é–å®š
- StatusManager æœªæ­£ç¢ºä¿å­˜

**è¨ºæ–·æ­¥é©Ÿï¼š**

1. **æª¢æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å…¶ä»–ç¨‹åºæ‰“é–‹ï¼š**
   ```powershell
   # æŸ¥çœ‹æª”æ¡ˆæ˜¯å¦è¢«é–å®š
   Get-Process | Where-Object {$_.MainWindowTitle -like "*status.json*"}
   ```

2. **æ‰‹å‹•æ¸¬è©¦ StatusManagerï¼š**
   åœ¨æœå‹™å™¨çµ‚ç«¯åŸ·è¡Œ Python æ¸¬è©¦ï¼š
   ```python
   python -c "from src.core.status_manager import StatusManager; sm = StatusManager(); sm.set_status('manga', 'æ¸¬è©¦', 'favorite'); print(sm.get_status('manga', 'æ¸¬è©¦'))"
   ```

3. **æª¢æŸ¥æ–‡ä»¶æ¬Šé™ï¼š**
   ```powershell
   # ç¢ºä¿æ–‡ä»¶å¯å¯«
   Set-ItemProperty -Path data\status.json -Name IsReadOnly -Value $false
   ```

## ğŸ“ å®Œæ•´æ¸¬è©¦æµç¨‹

### æ¸¬è©¦æ”¶è—åŠŸèƒ½

**æ­¥é©Ÿ 1: æº–å‚™æ¸¬è©¦ç’°å¢ƒ**
```powershell
# ç¢ºä¿æœå‹™å™¨é‹è¡Œ
# æ‰“é–‹ç€è¦½å™¨åˆ° http://127.0.0.1:5000/manga
```

**æ­¥é©Ÿ 2: æ‰“é–‹é–‹ç™¼è€…å·¥å…·**
```
æŒ‰ F12
åˆ‡æ›åˆ° Console æ¨™ç±¤
```

**æ­¥é©Ÿ 3: é€²å…¥ Reader é é¢**
```
é»æ“Šä»»æ„æ¼«ç•« â†’ é¸æ“‡ä»»æ„ç« ç¯€
```

**æ­¥é©Ÿ 4: æª¢æŸ¥ navigation**
```javascript
// åœ¨æ§åˆ¶å°åŸ·è¡Œ
console.log('Navigation:', window.reader.navigation);
console.log('Manga Name:', window.reader.navigation?.manga_name);
```

**æ­¥é©Ÿ 5: é»æ“Šæ˜Ÿæ˜Ÿ**
```
è§€å¯Ÿæ§åˆ¶å°è¼¸å‡º
åˆ‡æ›åˆ° Network æ¨™ç±¤æŸ¥çœ‹è«‹æ±‚
```

**æ­¥é©Ÿ 6: é©—è­‰çµæœ**
```powershell
# åœ¨å¦ä¸€å€‹çµ‚ç«¯æŸ¥çœ‹ JSON æ–‡ä»¶
Get-Content data\status.json | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

## ğŸ”§ å¿«é€Ÿä¿®å¾©è…³æœ¬

å‰µå»ºä¸€å€‹ PowerShell è…³æœ¬ä¾†é‡ç½®ç’°å¢ƒï¼š

```powershell
# reset-favorite.ps1

Write-Host "ğŸ”§ é‡ç½®æ”¶è—åŠŸèƒ½ç’°å¢ƒ..." -ForegroundColor Cyan

# 1. åœæ­¢å¯èƒ½çš„æœå‹™å™¨é€²ç¨‹
Write-Host "1. æª¢æŸ¥é‹è¡Œä¸­çš„æœå‹™å™¨..." -ForegroundColor Yellow
Get-Process python -ErrorAction SilentlyContinue | Stop-Process -Force
Start-Sleep -Seconds 2

# 2. é‡å»º status.json
Write-Host "2. é‡å»º status.json..." -ForegroundColor Yellow
if (Test-Path data\status.json) {
    Remove-Item data\status.json
}

$initialData = @{
    manga = @{
        favorite = @()
        unreviewed = @()
    }
    gallery = @{
        favorite = @()
        unreviewed = @()
    }
} | ConvertTo-Json -Depth 10

$initialData | Out-File -FilePath data\status.json -Encoding utf8

# 3. æª¢æŸ¥æ–‡ä»¶æ¬Šé™
Write-Host "3. æª¢æŸ¥æ–‡ä»¶æ¬Šé™..." -ForegroundColor Yellow
Set-ItemProperty -Path data\status.json -Name IsReadOnly -Value $false

# 4. é‡å•Ÿæœå‹™å™¨
Write-Host "4. é‡å•Ÿæœå‹™å™¨..." -ForegroundColor Yellow
Write-Host "è«‹æ‰‹å‹•åŸ·è¡Œ: cd src; python app.py" -ForegroundColor Green

Write-Host "âœ… ç’°å¢ƒé‡ç½®å®Œæˆï¼" -ForegroundColor Green
```

## ğŸ“Š è¨ºæ–·æ¸…å–®

ä½¿ç”¨æ­¤æ¸…å–®é€é …æª¢æŸ¥ï¼š

- [ ] æœå‹™å™¨æ­£åœ¨é‹è¡Œ
- [ ] data/status.json æ–‡ä»¶å­˜åœ¨
- [ ] status.json å¯å¯«å…¥ï¼ˆéåªè®€ï¼‰
- [ ] ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·å·²æ‰“é–‹
- [ ] Console ç„¡ JavaScript éŒ¯èª¤
- [ ] Network æ¨™ç±¤é¡¯ç¤º API è«‹æ±‚
- [ ] navigation.manga_name æœ‰å€¼
- [ ] GET /api/status è¿”å› 200
- [ ] POST /api/status è¿”å› 200
- [ ] æ˜Ÿæ˜Ÿåœ–æ¨™æ­£ç¢ºåˆ‡æ›
- [ ] status.json æ–‡ä»¶å…§å®¹æ›´æ–°

## ğŸ†˜ å¦‚æœä»ç„¶ç„¡æ³•å·¥ä½œ

è«‹æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç€è¦½å™¨æ§åˆ¶å°å®Œæ•´éŒ¯èª¤è¨Šæ¯**
2. **Network æ¨™ç±¤çš„è«‹æ±‚/éŸ¿æ‡‰è©³æƒ…**
3. **æœå‹™å™¨çµ‚ç«¯çš„éŒ¯èª¤è¼¸å‡º**
4. **navigation ç‰©ä»¶çš„å®Œæ•´å…§å®¹**
5. **ä½¿ç”¨çš„ç€è¦½å™¨ç‰ˆæœ¬**

é€™æ¨£æˆ‘å¯ä»¥æä¾›æ›´å…·é«”çš„è§£æ±ºæ–¹æ¡ˆï¼
