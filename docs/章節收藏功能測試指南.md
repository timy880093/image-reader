# 章節收藏功能測試指南

## 🚀 快速開始

### 1. 啟動服務器

```powershell
cd src
python app.py
```

確認看到以下訊息：
```
⭐ 收藏功能已啟用
🌐 服務器地址: http://127.0.0.1:5000
```

### 2. 打開瀏覽器

訪問：http://127.0.0.1:5000/manga

## 📋 測試步驟

### 測試 1：主頁 [只顯示收藏] 功能

#### 步驟 1.1：檢查 UI
- [ ] 在篩選按鈕旁邊看到 [只顯示收藏章節] checkbox
- [ ] checkbox 預設為未勾選狀態
- [ ] 顯示所有漫畫的所有章節

#### 步驟 1.2：勾選 checkbox
- [ ] 勾選 [只顯示收藏章節]
- [ ] 如果還沒有收藏任何章節，列表會變空或顯示完整章節
- [ ] 重新整理頁面，checkbox 狀態保持勾選

#### 步驟 1.3：取消勾選
- [ ] 取消勾選 [只顯示收藏章節]
- [ ] 顯示所有章節
- [ ] 重新整理頁面，checkbox 狀態保持未勾選

### 測試 2：Reader 頁面章節收藏

#### 步驟 2.1：進入 Reader
1. 在主頁點擊任意漫畫的第一個章節
2. 進入 Reader 頁面
3. 檢查右上角的星星按鈕

- [ ] 星星按鈕顯示為空心 ☆（未收藏）
- [ ] 滑鼠懸停時有放大效果
- [ ] Tooltip 顯示「加入收藏」

#### 步驟 2.2：收藏章節
1. 點擊星星按鈕
2. 觀察變化

- [ ] 星星變為實心 ★（已收藏）
- [ ] Tooltip 變為「取消收藏」
- [ ] 按鈕有短暫的 loading 狀態

#### 步驟 2.3：驗證持久化
1. 重新整理頁面
2. 檢查星星狀態

- [ ] 星星保持實心 ★
- [ ] 狀態正確保存

#### 步驟 2.4：取消收藏
1. 再次點擊星星按鈕
2. 觀察變化

- [ ] 星星變回空心 ☆
- [ ] Tooltip 變回「加入收藏」

### 測試 3：收藏多個章節

#### 步驟 3.1：收藏特定章節
假設漫畫有 10 個章節，收藏第 1、5、10 話：

1. 進入第 1 話，點擊星星收藏
2. 點擊「下一話」按鈕到第 2 話
3. 繼續點擊「下一話」直到第 5 話
4. 收藏第 5 話
5. 繼續到第 10 話並收藏

- [ ] 每個章節的收藏狀態獨立
- [ ] 收藏的章節顯示 ★
- [ ] 未收藏的章節顯示 ☆

### 測試 4：[只顯示收藏] 導航功能

#### 步驟 4.1：未勾選狀態（正常導航）
1. 回到主頁，確保 [只顯示收藏章節] 未勾選
2. 進入第 5 話
3. 測試導航按鈕

- [ ] 「上一話」按鈕可用，點擊後到第 4 話
- [ ] 「下一話」按鈕可用，點擊後到第 6 話
- [ ] 按 ← 鍵回到第 5 話
- [ ] 按 → 鍵到第 6 話

#### 步驟 4.2：勾選狀態（只在收藏間導航）
1. 回到主頁
2. 勾選 [只顯示收藏章節]
3. 進入第 5 話（已收藏）
4. 測試導航按鈕

- [ ] 「上一話」按鈕可用，點擊後到第 1 話（跳過 2、3、4）
- [ ] 「下一話」按鈕可用，點擊後到第 10 話（跳過 6、7、8、9）
- [ ] 按 ← 鍵回到第 5 話
- [ ] 按 → 鍵到第 10 話

#### 步驟 4.3：邊界測試
1. 在第 1 話（第一個收藏）

- [ ] 「上一話」按鈕禁用
- [ ] 「下一話」按鈕可用，到第 5 話

2. 在第 10 話（最後一個收藏）

- [ ] 「上一話」按鈕可用，到第 5 話
- [ ] 「下一話」按鈕禁用

### 測試 5：主頁章節列表篩選

#### 步驟 5.1：未勾選狀態
1. 回到主頁
2. 取消勾選 [只顯示收藏章節]
3. 查看漫畫卡片的章節列表

- [ ] 顯示所有章節（第 1-10 話）
- [ ] 每個章節都可以點擊

#### 步驟 5.2：勾選狀態
1. 勾選 [只顯示收藏章節]
2. 查看漫畫卡片的章節列表

- [ ] 只顯示收藏的章節（第 1、5、10 話）
- [ ] 未收藏的章節不顯示
- [ ] 章節數量顯示正確

### 測試 6：與狀態篩選的配合

#### 步驟 6.1：測試組合篩選
1. 點擊「⭐ 收藏」按鈕（這是漫畫級別的篩選）
2. 勾選 [只顯示收藏章節]

- [ ] 只顯示有收藏狀態的漫畫
- [ ] 這些漫畫只顯示收藏的章節
- [ ] 兩個篩選條件同時生效

#### 步驟 6.2：測試其他組合
1. 點擊「☑ 已審核」
2. 勾選 [只顯示收藏章節]

- [ ] 顯示已審核的漫畫
- [ ] 只顯示這些漫畫中收藏的章節

### 測試 7：數據持久化

#### 步驟 7.1：檢查 status.json
1. 打開 `data/status.json` 文件
2. 查看內容

```powershell
Get-Content data\status.json | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

預期內容：
```json
{
  "manga": {
    "favorite": [
      "漫畫名稱/第001話",
      "漫畫名稱/第005話",
      "漫畫名稱/第010話"
    ],
    "reviewed": []
  }
}
```

- [ ] 收藏的章節路徑正確記錄
- [ ] JSON 格式正確

#### 步驟 7.2：檢查 localStorage
1. 打開瀏覽器開發者工具（F12）
2. 切換到 Application 或 Storage 標籤
3. 找到 Local Storage → http://127.0.0.1:5000
4. 查看 `manga_favorite_only` 鍵

- [ ] 勾選時值為 'true'
- [ ] 未勾選時值為 'false'

#### 步驟 7.3：重啟測試
1. 停止服務器（Ctrl+C）
2. 重新啟動服務器
3. 重新打開瀏覽器

- [ ] 章節收藏狀態保持
- [ ] [只顯示收藏] 設定保持
- [ ] 所有功能正常工作

### 測試 8：瀏覽器控制台檢查

#### 步驟 8.1：檢查錯誤
1. 打開開發者工具（F12）
2. 切換到 Console 標籤
3. 執行各種操作

- [ ] 沒有紅色錯誤訊息
- [ ] API 請求成功（200 OK）

#### 步驟 8.2：檢查網路請求
1. 切換到 Network 標籤
2. 勾選 [只顯示收藏章節]
3. 觀察請求

預期請求：
```
GET /manga/api/list?page=1&per_page=6&skip_chapters=false&favorite_only=true
```

- [ ] URL 包含 `favorite_only=true` 參數
- [ ] 響應狀態 200 OK

4. 進入 Reader 頁面
5. 觀察請求

預期請求：
```
GET /manga/api/chapter/漫畫名稱/第001話?favorite_only=true
```

- [ ] URL 包含 `favorite_only=true` 參數
- [ ] 響應包含正確的導航信息

## 🐛 常見問題排查

### 問題 1：checkbox 不顯示
**檢查：**
- 清除瀏覽器快取（Ctrl+Shift+Delete）
- 強制重新整理（Ctrl+F5）

### 問題 2：收藏狀態不保存
**檢查：**
```powershell
# 檢查文件權限
Get-Acl data\status.json

# 檢查文件內容
Get-Content data\status.json
```

### 問題 3：導航不正確
**檢查：**
1. 打開開發者工具 Console
2. 執行：
```javascript
console.log(window.reader.navigation);
console.log(window.reader.favoriteOnly);
```

### 問題 4：設定不保持
**檢查：**
1. 開發者工具 → Application → Local Storage
2. 確認 `manga_favorite_only` 存在
3. 如果不存在，可能是瀏覽器隱私設定阻止了 localStorage

## ✅ 完整測試檢查表

### 基本功能
- [ ] [只顯示收藏章節] checkbox 顯示
- [ ] checkbox 狀態可以切換
- [ ] 設定保存到 localStorage
- [ ] 重新整理後設定保持

### 主頁功能
- [ ] 未勾選時顯示所有章節
- [ ] 勾選時只顯示收藏章節
- [ ] 與狀態篩選按鈕配合正常
- [ ] 章節列表正確更新

### Reader 功能
- [ ] 章節收藏按鈕正常工作
- [ ] 收藏狀態正確顯示
- [ ] 未勾選時正常順序導航
- [ ] 勾選時只在收藏間導航
- [ ] 方向鍵快捷鍵正常工作
- [ ] 邊界情況處理正確

### 數據持久化
- [ ] 章節收藏保存到 status.json
- [ ] 設定保存到 localStorage
- [ ] 重啟服務器後數據保持
- [ ] JSON 格式正確

### 性能和錯誤
- [ ] 無 JavaScript 錯誤
- [ ] API 請求成功
- [ ] 頁面載入流暢
- [ ] 無記憶體洩漏

## 🎉 測試通過標準

所有檢查項目都打勾，即表示功能完整且正常運作！

## 📝 測試報告模板

```
測試日期：____________________
測試人員：____________________

【基本功能】
✅/❌ checkbox 顯示和切換
✅/❌ 設定持久化

【主頁功能】
✅/❌ 章節列表篩選
✅/❌ 與狀態篩選配合

【Reader 功能】
✅/❌ 章節收藏
✅/❌ 導航功能（未勾選）
✅/❌ 導航功能（勾選）
✅/❌ 快捷鍵支援

【數據持久化】
✅/❌ status.json 正確
✅/❌ localStorage 正確
✅/❌ 重啟後保持

【問題記錄】
_________________________________
_________________________________

【總體評價】
✅ 所有功能正常
❌ 發現問題：___________________
```
