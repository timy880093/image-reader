# ç‹€æ…‹ç³»çµ±é‡æ§‹èªªæ˜

## ğŸ“‹ è®Šæ›´æ¦‚è¿°

### ç‹€æ…‹å®šç¾©è®Šæ›´

**èˆŠç³»çµ±ï¼š**
```json
{
  "manga": {
    "favorite": [],
    "unreviewed": []
  }
}
```

**æ–°ç³»çµ±ï¼š**
```json
{
  "manga": {
    "favorite": [],
    "reviewed": []
  }
}
```

### æ ¸å¿ƒè®Šæ›´

1. âœ… **ç§»é™¤ `unreviewed` å¯¦é«”ç‹€æ…‹**
   - ä¸å†åœ¨ JSON ä¸­å„²å­˜ `unreviewed` åˆ—è¡¨
   
2. âœ… **æ–°å¢ `reviewed` å¯¦é«”ç‹€æ…‹**
   - åœ¨ JSON ä¸­å„²å­˜å·²å¯©æ ¸çš„é …ç›®åˆ—è¡¨
   
3. âœ… **`unreviewed` æ”¹ç‚ºè™›æ“¬ç‹€æ…‹**
   - è¡¨ç¤ºã€Œä¸åœ¨ favorite ä¹Ÿä¸åœ¨ reviewed åˆ—è¡¨ä¸­ã€çš„é …ç›®
   - é€šéåå‘é‚è¼¯è¨ˆç®—å¾—å‡º

## ğŸ¯ ç‹€æ…‹é‚è¼¯

### ä¸‰ç¨®ç‹€æ…‹

#### 1. `favorite` (æ”¶è—)
- **å„²å­˜æ–¹å¼ï¼š** å­˜åœ¨ JSON çš„ `favorite` æ•¸çµ„ä¸­
- **åˆ¤æ–·é‚è¼¯ï¼š** `item_path in data[category]['favorite']`
- **ç”¨é€”ï¼š** æ¨™è¨˜é‡è¦æˆ–å–œæ­¡çš„ä½œå“

#### 2. `reviewed` (å·²å¯©æ ¸)
- **å„²å­˜æ–¹å¼ï¼š** å­˜åœ¨ JSON çš„ `reviewed` æ•¸çµ„ä¸­
- **åˆ¤æ–·é‚è¼¯ï¼š** `item_path in data[category]['reviewed']`
- **ç”¨é€”ï¼š** æ¨™è¨˜å·²ç¶“çœ‹é/å¯©æ ¸éçš„ä½œå“

#### 3. `unreviewed` (æœªå¯©æ ¸) - **è™›æ“¬ç‹€æ…‹**
- **å„²å­˜æ–¹å¼ï¼š** ä¸å„²å­˜ï¼ˆè™›æ“¬ç‹€æ…‹ï¼‰
- **åˆ¤æ–·é‚è¼¯ï¼š** `item_path NOT IN (favorite âˆª reviewed)`
- **ç”¨é€”ï¼š** é¡¯ç¤ºå°šæœªè™•ç†çš„æ–°ä½œå“

### ç‹€æ…‹å„ªå…ˆç´š

```python
if item_path in favorite:
    return "favorite"
elif item_path in reviewed:
    return "reviewed"
else:
    return "unreviewed"  # è™›æ“¬ç‹€æ…‹
```

## ğŸ”„ ç¯©é¸é‚è¼¯

### `filter_by_status()` å¯¦ç¾

#### 1. ç¯©é¸ã€Œæ”¶è—ã€
```python
status_items = set(data[category]['favorite'])
return [item for item in items if item.name in status_items]
```

#### 2. ç¯©é¸ã€Œå·²å¯©æ ¸ã€
```python
status_items = set(data[category]['reviewed'])
return [item for item in items if item.name in status_items]
```

#### 3. ç¯©é¸ã€Œæœªå¯©æ ¸ã€ï¼ˆåå‘é‚è¼¯ï¼‰
```python
favorite_set = set(data[category]['favorite'])
reviewed_set = set(data[category]['reviewed'])
excluded_set = favorite_set | reviewed_set
return [item for item in items if item.name NOT IN excluded_set]
```

## ğŸ“ ä½¿ç”¨ç¯„ä¾‹

### è¨­ç½®ç‹€æ…‹

```python
from core.status_manager import StatusManager

sm = StatusManager()

# è¨­ç‚ºæ”¶è—
sm.set_status('manga', 'æµ·è³Šç‹', 'favorite')

# è¨­ç‚ºå·²å¯©æ ¸
sm.set_status('manga', 'ç«å½±å¿è€…', 'reviewed')

# è¨­ç‚ºæœªå¯©æ ¸ï¼ˆå¾æ‰€æœ‰åˆ—è¡¨ä¸­ç§»é™¤ï¼‰
sm.set_status('manga', 'æ–°æ¼«ç•«', 'unreviewed')
```

### ç²å–ç‹€æ…‹

```python
# ç²å–å–®å€‹é …ç›®çš„ç‹€æ…‹
status = sm.get_status('manga', 'æµ·è³Šç‹')
# è¿”å›: 'favorite'

status = sm.get_status('manga', 'ç«å½±å¿è€…')
# è¿”å›: 'reviewed'

status = sm.get_status('manga', 'æ–°æ¼«ç•«')
# è¿”å›: 'unreviewed'ï¼ˆè™›æ“¬ç‹€æ…‹ï¼‰
```

### ç¯©é¸åˆ—è¡¨

```python
from pathlib import Path

# å‡è¨­æœ‰ä»¥ä¸‹æ¼«ç•«è³‡æ–™å¤¾
all_mangas = [
    Path('/manga/æµ·è³Šç‹'),
    Path('/manga/ç«å½±å¿è€…'),
    Path('/manga/æ–°æ¼«ç•«1'),
    Path('/manga/æ–°æ¼«ç•«2'),
]

# ç¯©é¸æ”¶è—
favorites = sm.filter_by_status('manga', all_mangas, 'favorite')
# è¿”å›: [Path('/manga/æµ·è³Šç‹')]

# ç¯©é¸å·²å¯©æ ¸
reviewed = sm.filter_by_status('manga', all_mangas, 'reviewed')
# è¿”å›: [Path('/manga/ç«å½±å¿è€…')]

# ç¯©é¸æœªå¯©æ ¸
unreviewed = sm.filter_by_status('manga', all_mangas, 'unreviewed')
# è¿”å›: [Path('/manga/æ–°æ¼«ç•«1'), Path('/manga/æ–°æ¼«ç•«2')]
```

## ğŸ¨ å‰ç«¯é¡¯ç¤º

### åˆ—è¡¨é é¢ç¯©é¸æŒ‰éˆ•

```html
<div class="filter-bar">
    <button class="filter-btn active" data-status="all">å…¨éƒ¨</button>
    <button class="filter-btn" data-status="favorite">â­ æ”¶è—</button>
    <button class="filter-btn" data-status="unreviewed">ğŸ†• æœªå¯©æ ¸</button>
</div>
```

**èªªæ˜ï¼š**
- é»æ“Šã€Œæœªå¯©æ ¸ã€æœƒé¡¯ç¤º**æ²’æœ‰**è¢«æ¨™è¨˜ç‚ºæ”¶è—æˆ–å·²å¯©æ ¸çš„é …ç›®
- é€™æ˜¯é€šéåå‘é‚è¼¯è¨ˆç®—çš„è™›æ“¬ç‹€æ…‹

### Reader é é¢æ”¶è—æŒ‰éˆ•

æ”¶è—ç‹€æ…‹åˆ‡æ›é‚è¼¯ï¼š
```
æœªå¯©æ ¸ (â˜†) â†’ é»æ“Š â†’ æ”¶è— (â˜…)
æ”¶è— (â˜…)   â†’ é»æ“Š â†’ å·²å¯©æ ¸ (â˜†)
å·²å¯©æ ¸ (â˜†) â†’ é»æ“Š â†’ æ”¶è— (â˜…)
```

å°æ‡‰çš„ API èª¿ç”¨ï¼š
```javascript
// ç•¶å‰æœªå¯©æ ¸ â†’ è¨­ç‚ºæ”¶è—
fetch('/api/status/xxx', {
    method: 'POST',
    body: JSON.stringify({ status: 'favorite' })
})

// ç•¶å‰æ”¶è— â†’ è¨­ç‚ºå·²å¯©æ ¸
fetch('/api/status/xxx', {
    method: 'POST',
    body: JSON.stringify({ status: 'reviewed' })
})
```

## ğŸ“¦ æ•¸æ“šé·ç§»

### è‡ªå‹•é·ç§»

StatusManager åœ¨è¼‰å…¥æ™‚æœƒè‡ªå‹•é·ç§»èˆŠæ•¸æ“šï¼š

```python
def _load(self) -> Dict:
    # ... è¼‰å…¥ JSON ...
    
    # é·ç§»èˆŠæ•¸æ“š
    for category in ['manga', 'gallery']:
        if category in data:
            # åˆªé™¤èˆŠçš„ unreviewed éµ
            if 'unreviewed' in data[category]:
                del data[category]['unreviewed']
            
            # ç¢ºä¿ reviewed éµå­˜åœ¨
            if 'reviewed' not in data[category]:
                data[category]['reviewed'] = []
    
    return data
```

### æ‰‹å‹•é·ç§»

å¦‚æœéœ€è¦ä¿ç•™èˆŠçš„ `unreviewed` æ•¸æ“šï¼Œå¯ä»¥æ‰‹å‹•é·ç§»ï¼š

```python
# å°‡èˆŠçš„ unreviewed æ•¸æ“šç§»åˆ°æ–°çµæ§‹
old_unreviewed = data['manga'].get('unreviewed', [])

# é¸é … 1: å…¨éƒ¨æ¨™è¨˜ç‚ºæœªå¯©æ ¸ï¼ˆåˆªé™¤å³å¯ï¼‰
# ä¸éœ€è¦åšä»»ä½•äº‹ï¼Œåˆªé™¤ unreviewed éµå¾Œå®ƒå€‘è‡ªå‹•è®Šç‚ºæœªå¯©æ ¸ç‹€æ…‹

# é¸é … 2: å…¨éƒ¨æ¨™è¨˜ç‚ºå·²å¯©æ ¸
data['manga']['reviewed'].extend(old_unreviewed)
data['manga']['reviewed'] = list(set(data['manga']['reviewed']))

# æ¸…ç†èˆŠéµ
del data['manga']['unreviewed']
```

## ğŸ” ç‹€æ…‹åˆ¤æ–·æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æª¢æŸ¥é …ç›®è·¯å¾‘   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    åœ¨ favorite?
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   æ˜¯â”‚        â”‚å¦
    â”‚         â”‚
    â–¼         â–¼
 favorite  åœ¨ reviewed?
              â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        æ˜¯â”‚        â”‚å¦
         â”‚         â”‚
         â–¼         â–¼
     reviewed  unreviewed
              (è™›æ“¬ç‹€æ…‹)
```

## âœ… å„ªå‹¢

### 1. ç¯€çœå„²å­˜ç©ºé–“
- ä¸éœ€è¦å„²å­˜å¤§é‡çš„æœªå¯©æ ¸é …ç›®
- JSON æ–‡ä»¶æ›´å°æ›´å¿«

### 2. é‚è¼¯æ›´æ¸…æ™°
- åªå„²å­˜æœ‰æ„ç¾©çš„æ¨™è¨˜
- æœªå¯©æ ¸æ˜¯è‡ªç„¶çš„é è¨­ç‹€æ…‹

### 3. è‡ªå‹•åŒæ­¥
- æ–°å¢çš„é …ç›®è‡ªå‹•é¡¯ç¤ºç‚ºæœªå¯©æ ¸
- ä¸éœ€è¦æ‰‹å‹•æ·»åŠ åˆ° unreviewed åˆ—è¡¨

### 4. ç¶­è­·ç°¡å–®
- åªéœ€è¦ç®¡ç†å…©å€‹åˆ—è¡¨
- æ¸›å°‘æ•¸æ“šä¸ä¸€è‡´çš„å¯èƒ½æ€§

## ğŸ§ª æ¸¬è©¦é©—è­‰

### æ¸¬è©¦ç”¨ä¾‹

```python
# æ¸¬è©¦ 1: æ–°é …ç›®æ‡‰è©²æ˜¯æœªå¯©æ ¸ç‹€æ…‹
assert sm.get_status('manga', 'æ–°æ¼«ç•«') == 'unreviewed'

# æ¸¬è©¦ 2: è¨­ç‚ºæ”¶è—å¾Œæ‡‰è©²æ˜¯æ”¶è—ç‹€æ…‹
sm.set_status('manga', 'æ–°æ¼«ç•«', 'favorite')
assert sm.get_status('manga', 'æ–°æ¼«ç•«') == 'favorite'

# æ¸¬è©¦ 3: å¾æ”¶è—æ”¹ç‚ºå·²å¯©æ ¸
sm.set_status('manga', 'æ–°æ¼«ç•«', 'reviewed')
assert sm.get_status('manga', 'æ–°æ¼«ç•«') == 'reviewed'

# æ¸¬è©¦ 4: æ”¹ç‚ºæœªå¯©æ ¸æ‡‰è©²å¾æ‰€æœ‰åˆ—è¡¨ä¸­ç§»é™¤
sm.set_status('manga', 'æ–°æ¼«ç•«', 'unreviewed')
assert sm.get_status('manga', 'æ–°æ¼«ç•«') == 'unreviewed'
assert 'æ–°æ¼«ç•«' not in sm.data['manga']['favorite']
assert 'æ–°æ¼«ç•«' not in sm.data['manga']['reviewed']

# æ¸¬è©¦ 5: ç¯©é¸æœªå¯©æ ¸æ‡‰è©²æ’é™¤å·²æ¨™è¨˜çš„é …ç›®
all_items = [Path('manga1'), Path('manga2'), Path('manga3')]
sm.set_status('manga', 'manga1', 'favorite')
sm.set_status('manga', 'manga2', 'reviewed')
unreviewed = sm.filter_by_status('manga', all_items, 'unreviewed')
assert len(unreviewed) == 1
assert unreviewed[0].name == 'manga3'
```

## ğŸ‰ ç¸½çµ

| ç‰¹æ€§ | èˆŠç³»çµ± | æ–°ç³»çµ± |
|------|--------|--------|
| æ”¶è— | âœ… å­˜åœ¨ favorite åˆ—è¡¨ | âœ… å­˜åœ¨ favorite åˆ—è¡¨ |
| å·²å¯©æ ¸ | âŒ ç„¡æ­¤ç‹€æ…‹ | âœ… å­˜åœ¨ reviewed åˆ—è¡¨ |
| æœªå¯©æ ¸ | å­˜åœ¨ unreviewed åˆ—è¡¨ | âœ… è™›æ“¬ç‹€æ…‹ï¼ˆåå‘è¨ˆç®—ï¼‰ |
| JSON å¤§å° | è¼ƒå¤§ | âœ… è¼ƒå° |
| æ–°å¢é …ç›® | éœ€è¦æ‰‹å‹•æ·»åŠ åˆ° unreviewed | âœ… è‡ªå‹•æ˜¯æœªå¯©æ ¸ç‹€æ…‹ |
| ç¶­è­·è¤‡é›œåº¦ | è¼ƒé«˜ | âœ… è¼ƒä½ |

**æ–°ç³»çµ±æ›´é«˜æ•ˆã€æ›´æ˜“ç¶­è­·ï¼ŒåŒæ™‚æä¾›äº†æ›´éˆæ´»çš„ç‹€æ…‹ç®¡ç†ï¼** ğŸŠ
