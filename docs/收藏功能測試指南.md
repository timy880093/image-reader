# 收藏功能測試指南

## ✅ 啟動檢查結果

### 自動創建的文件
- ✅ `data/` 目錄已創建
- ✅ `data/status.json` 文件已創建
- ✅ 初始 JSON 結構正確

### 服務器啟動訊息
```
✅ 配置文件載入成功: ..\config.toml
✅ 數據目錄檢查完成
==================================================
🎌 本地漫畫閱讀器
==================================================
📁 漫畫資料夾: E:\test\manga
🎨 Gallery 資料夾: E:\test\pixiv
💾 狀態文件: E:\_code\vibe\manga-reader\data\status.json
🌐 服務器地址: http://127.0.0.1:5000
🎨 主題: dark
🌍 語言: zh-TW
==================================================
📖 請在瀏覽器中開啟上方地址開始使用
🔧 配置文件位置: ../config.toml
⭐ 收藏功能已啟用
⏹️  按 Ctrl+C 停止服務器
==================================================
```

## 🧪 測試步驟

### 1. 測試收藏功能（Manga）

1. **打開瀏覽器**
   - 訪問 http://127.0.0.1:5000/manga

2. **進入 Reader 頁面**
   - 點擊任意漫畫
   - 選擇任意章節進入閱讀器

3. **測試收藏按鈕**
   - 在右上角找到星星按鈕（☆）
   - 點擊星星，應該變為實心（★）
   - 再次點擊，應該變回空心（☆）

4. **檢查狀態持久化**
   - 重新整理頁面
   - 收藏狀態應該保持（★ 或 ☆）

5. **檢查 JSON 文件**
   - 打開 `data/status.json`
   - 應該看到收藏的漫畫名稱在 `manga.favorite` 數組中

### 2. 測試收藏功能（Gallery）

1. **打開 Gallery**
   - 訪問 http://127.0.0.1:5000/gallery

2. **進入 Reader 頁面**
   - 點擊任意 Gallery 作品

3. **測試收藏按鈕**
   - 點擊右上角星星
   - 驗證切換功能

4. **檢查 JSON 文件**
   - Gallery 收藏應該在 `gallery.favorite` 數組中

### 3. 測試瀏覽器控制台

1. **打開開發者工具**
   - 按 F12 或右鍵 → 檢查

2. **查看 Network 標籤**
   - 點擊收藏按鈕
   - 應該看到以下請求：
     - `GET /manga/api/status/<漫畫名稱>` - 200 OK
     - `POST /manga/api/status/<漫畫名稱>` - 200 OK

3. **查看 Console 標籤**
   - 不應該有錯誤訊息
   - 可能有信息訊息（正常）

## 📊 預期結果

### API 響應範例

**GET /manga/api/status/測試漫畫**
```json
{
  "status": "favorite",
  "path": "測試漫畫"
}
```

**POST /manga/api/status/測試漫畫**
```json
{
  "status": "reviewed"
}
```

### status.json 範例

收藏幾個項目後：
```json
{
  "manga": {
    "favorite": [
      "海賊王",
      "火影忍者"
    ],
    "unreviewed": [
      "新漫畫1"
    ]
  },
  "gallery": {
    "favorite": [
      "精選作品A",
      "精選作品B"
    ],
    "unreviewed": []
  }
}
```

## 🐛 疑難排解

### 問題 1：星星按鈕無反應
**檢查項目：**
- [ ] 瀏覽器控制台是否有 JavaScript 錯誤
- [ ] Network 標籤是否有 API 請求失敗
- [ ] 服務器終端是否有錯誤訊息

**解決方法：**
- 清除瀏覽器快取（Ctrl+Shift+Delete）
- 重新啟動服務器
- 檢查 `data/status.json` 是否可寫入

### 問題 2：收藏狀態不保存
**檢查項目：**
- [ ] `data/status.json` 文件是否存在
- [ ] 文件是否有寫入權限
- [ ] JSON 格式是否正確

**解決方法：**
```powershell
# 檢查文件權限
Get-Acl data\status.json

# 刪除並重新創建（會丟失數據）
Remove-Item data\status.json
# 重新啟動服務器會自動創建
```

### 問題 3：404 錯誤
**可能原因：**
- 路由未正確註冊
- 路徑解析錯誤

**檢查方法：**
```powershell
# 查看終端輸出，尋找類似訊息：
# 404 - GET /manga/api/status/...
```

**解決方法：**
- 確認 `routes.py` 中的路由已註冊
- 檢查 URL 路徑是否正確
- 查看漫畫/Gallery 名稱中是否有特殊字符

### 問題 4：狀態顯示錯誤
**症狀：**
- 明明已收藏但顯示空心星星
- 或相反

**解決方法：**
```powershell
# 1. 停止服務器（Ctrl+C）
# 2. 檢查 status.json 內容
Get-Content data\status.json | ConvertFrom-Json | ConvertTo-Json -Depth 10

# 3. 如果格式錯誤，重置文件
@"
{
  "manga": {
    "favorite": [],
    "unreviewed": []
  },
  "gallery": {
    "favorite": [],
    "unreviewed": []
  }
}
"@ | Out-File -FilePath data\status.json -Encoding utf8

# 4. 重新啟動服務器
```

## ✅ 測試檢查表

### 基本功能
- [ ] 服務器啟動成功
- [ ] data 目錄自動創建
- [ ] status.json 自動創建
- [ ] 啟動訊息顯示正確

### Manga 收藏
- [ ] 進入 Manga Reader 頁面
- [ ] 星星按鈕顯示正常
- [ ] 點擊切換收藏狀態
- [ ] 星星圖標正確切換（☆ ↔ ★）
- [ ] 重新整理後狀態保持
- [ ] status.json 正確記錄

### Gallery 收藏
- [ ] 進入 Gallery Reader 頁面
- [ ] 星星按鈕顯示正常
- [ ] 點擊切換收藏狀態
- [ ] 星星圖標正確切換
- [ ] 重新整理後狀態保持
- [ ] status.json 正確記錄

### API 測試
- [ ] GET 請求返回正確狀態
- [ ] POST 請求成功更新狀態
- [ ] 響應格式正確
- [ ] 無 CORS 錯誤
- [ ] 無 404/500 錯誤

### 數據持久化
- [ ] 收藏後 JSON 文件更新
- [ ] 取消收藏後從 JSON 移除
- [ ] 多次操作數據一致
- [ ] 重啟服務器後數據保留

## 📝 測試報告模板

```
測試日期：2026-01-10
測試人員：[您的名字]
測試環境：Windows / Python 3.13

【基本功能】
✅ 服務器啟動：正常
✅ 文件自動創建：正常

【Manga 收藏功能】
✅ 星星顯示：正常
✅ 收藏切換：正常
✅ 狀態持久化：正常

【Gallery 收藏功能】
✅ 星星顯示：正常
✅ 收藏切換：正常
✅ 狀態持久化：正常

【API 測試】
✅ GET /manga/api/status：200 OK
✅ POST /manga/api/status：200 OK
✅ GET /gallery/api/status：200 OK
✅ POST /gallery/api/status：200 OK

【問題記錄】
無

【總體評價】
所有功能正常運作 ✅
```

## 🎉 測試通過標準

所有以下項目都應該打勾：
- ✅ 服務器啟動無錯誤
- ✅ 數據文件自動創建
- ✅ 星星按鈕正常顯示
- ✅ 收藏功能正常工作
- ✅ 狀態正確保存到 JSON
- ✅ 重新整理後狀態保持
- ✅ 無瀏覽器控制台錯誤
- ✅ API 請求全部成功

如果所有項目都通過，收藏功能即可正式使用！🎊
