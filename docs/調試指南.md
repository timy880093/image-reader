# 測試和調試指南

## 🔍 如何測試點擊功能

### 1. 打開瀏覽器開發者工具
按 `F12` 或右鍵 → 檢查

### 2. 查看 Console 標籤
看是否有 JavaScript 錯誤

### 3. 測試點擊
點擊一個漫畫資料夾，觀察 Console 輸出

## 🐛 常見錯誤和解決方法

### 錯誤 1: `apiPrefix is not defined`
**已修復** - 添加了 `apiPrefix` 變數定義

### 錯誤 2: `Cannot read property 'path' of undefined`
**原因**: 找不到對應的漫畫對象
**解決**: 檢查 `allMangas` 數組是否正確載入

### 錯誤 3: 404 錯誤
**可能原因**:
- API 路由不正確
- 路徑編碼問題
- 後端路由未正確配置

## 📋 手動測試步驟

### 測試 API 端點

1. **測試列表 API**
   ```
   http://localhost:5000/api/manga/list?skip_chapters=true
   ```
   應該返回漫畫列表（不含章節詳情）

2. **測試詳情 API**
   ```
   http://localhost:5000/api/manga/detail/漫畫名稱
   ```
   應該返回包含章節列表的 JSON

3. **在 Console 中測試**
   ```javascript
   // 在瀏覽器 Console 中執行
   fetch('/api/manga/detail/測試漫畫')
     .then(r => r.json())
     .then(d => console.log(d))
   ```

### 測試點擊功能

1. **在 Console 中直接調用**
   ```javascript
   // 查看當前載入的漫畫
   console.log(allMangas);
   
   // 測試 openManga 函數
   openManga('漫畫名稱');
   ```

2. **檢查變數**
   ```javascript
   console.log('apiPrefix:', apiPrefix);
   console.log('readerPrefix:', readerPrefix);
   console.log('currentCategory:', currentCategory);
   ```

## 🔧 調試代碼片段

在 `openManga` 函數中添加調試輸出：

```javascript
async function openManga(mangaPath) {
    console.log('=== openManga 開始 ===');
    console.log('mangaPath:', mangaPath);
    console.log('allMangas:', allMangas);
    
    const manga = allMangas.find(m => m.path === mangaPath);
    console.log('找到的 manga:', manga);
    
    if (!manga) {
        console.error('找不到漫畫對象');
        return;
    }
    
    // 如果已經有章節列表
    if (manga.chapters && manga.chapters.length > 0) {
        console.log('使用快取的章節列表');
        console.log('第一個章節:', manga.chapters[0]);
        openChapter(manga.chapters[0].path);
        return;
    }
    
    // 獲取章節信息
    console.log('需要獲取章節信息');
    const url = `${apiPrefix}/detail/${encodeURIComponent(mangaPath)}`;
    console.log('API URL:', url);
    
    try {
        const response = await fetch(url);
        console.log('API 響應狀態:', response.status);
        
        if (!response.ok) {
            console.error('API 請求失敗');
            throw new Error('無法獲取章節信息');
        }
        
        const detail = await response.json();
        console.log('獲取到的詳情:', detail);
        
        if (detail.chapters && detail.chapters.length > 0) {
            console.log('打開第一個章節:', detail.chapters[0].path);
            openChapter(detail.chapters[0].path);
        } else {
            console.warn('沒有可用的章節');
            alert('此漫畫沒有可用的章節');
        }
    } catch (error) {
        console.error('錯誤:', error);
        alert('無法打開此漫畫，請稍後再試');
    }
    
    console.log('=== openManga 結束 ===');
}
```

## 📊 預期的控制台輸出

### 成功的情況
```
=== openManga 開始 ===
mangaPath: 測試漫畫
allMangas: [{name: "測試漫畫", path: "測試漫畫", ...}]
找到的 manga: {name: "測試漫畫", chapter_count: 5, ...}
需要獲取章節信息
API URL: /api/manga/detail/測試漫畫
API 響應狀態: 200
獲取到的詳情: {name: "測試漫畫", chapters: [...]}
打開第一個章節: 測試漫畫/第1話
=== openManga 結束 ===
```

### 失敗的情況
```
=== openManga 開始 ===
mangaPath: 不存在的漫畫
allMangas: [{name: "測試漫畫", ...}]
找到的 manga: undefined
找不到漫畫對象
=== openManga 結束 ===
```

## 🚀 快速修復建議

如果仍然無法點擊，請嘗試：

1. **清除瀏覽器緩存**
   - 按 `Ctrl + F5` 強制刷新
   - 或清除瀏覽器緩存

2. **重啟應用**
   ```powershell
   # 停止應用 (Ctrl+C)
   # 重新啟動
   python app.py
   ```

3. **檢查路徑編碼**
   - 如果漫畫名稱包含特殊字符
   - 可能需要額外的 URL 編碼處理

4. **直接測試 API**
   - 在瀏覽器中訪問 API URL
   - 確認返回正確的 JSON 數據

## 📝 需要提供的調試信息

如果問題持續，請提供：

1. **瀏覽器 Console 的完整錯誤訊息**
2. **Network 標籤中失敗的請求詳情**
3. **後端終端的錯誤日誌**
4. **嘗試點擊的漫畫名稱**
5. **瀏覽器類型和版本**
