# 列表頁面狀態篩選功能實現

## ✅ 完成項目

### 🎯 功能特點

1. **添加狀態篩選按鈕**
   - 全部 - 顯示所有作品
   - ⭐ 收藏 - 只顯示已收藏的作品
   - 🆕 未審核 - 只顯示未審核的作品

2. **移除舊的精選篩選**
   - ❌ 刪除基於 marker 文件的精選篩選
   - ✅ 改用新的狀態管理系統

3. **統一設計風格**
   - Manga 和 Gallery 使用相同的篩選界面
   - 一致的按鈕樣式和交互效果

## 📝 修改的文件

### 1. HTML 模板

#### Manga Index (`src/modules/manga/templates/manga/index.html`)
```html
<div class="filter-bar">
    <button class="filter-btn active" data-status="all">全部</button>
    <button class="filter-btn" data-status="favorite">⭐ 收藏</button>
    <button class="filter-btn" data-status="unreviewed">🆕 未審核</button>
</div>
```

**變更：**
- ✅ 新增 `filter-bar` 區塊
- ✅ 添加三個篩選按鈕
- ✅ 使用 `data-status` 屬性標記狀態

#### Gallery Index (`src/modules/gallery/templates/gallery/index.html`)
```html
<!-- 移除舊的 filter-tags -->
<div class="filter-bar">
    <button class="filter-btn active" data-status="all">全部</button>
    <button class="filter-btn" data-status="favorite">⭐ 收藏</button>
    <button class="filter-btn" data-status="unreviewed">🆕 未審核</button>
</div>
```

**變更：**
- ❌ 移除 `filter-tags` 和精選按鈕
- ✅ 新增統一的 `filter-bar`
- ✅ 移除 `onclick="setFilter()"` 內聯事件

### 2. CSS 樣式 (`src/static/css/common.css`)

新增篩選按鈕樣式：

```css
.filter-bar {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 10px 20px;
    background: #f0f0f0;
    border: 2px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s;
    color: #666;
}

.filter-btn:hover {
    background: #e0e0e0;
    border-color: #667eea;
    transform: translateY(-2px);
}

.filter-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}
```

**特點：**
- 🎨 漸變背景的 active 狀態
- ✨ 懸停動畫效果
- 📱 響應式設計（flex-wrap）

### 3. JavaScript 邏輯

#### Manga Index (`src/static/js/manga/index.js`)

**新增變數：**
```javascript
let currentFilter = 'all';  // 當前篩選狀態
```

**綁定篩選事件：**
```javascript
// 篩選按鈕事件
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        // 移除所有 active 類
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        // 添加 active 到點擊的按鈕
        e.target.classList.add('active');
        // 設置當前篩選
        currentFilter = e.target.dataset.status;
        // 重新載入
        currentPage = 1;
        loadMangas();
    });
});
```

**API 請求更新：**
```javascript
// 構建 API URL，包含狀態篩選
let url = `${API_PREFIX}/list?page=${page}&per_page=6&skip_chapters=false`;
if (currentFilter && currentFilter !== 'all') {
    url += `&status=${currentFilter}`;
}
```

#### Gallery Index (`src/static/js/gallery/index.js`)

**變更變數名稱：**
```javascript
let currentStatusFilter = 'all';  // 改為狀態篩選（原為 currentFilter）
```

**移除舊函數：**
```javascript
// ❌ 移除 setFilter(filterTag) 函數
```

**添加篩選事件：**
```javascript
// 篩選按鈕事件（與 Manga 相同）
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        currentStatusFilter = e.target.dataset.status;
        currentPage = 1;
        loadWorks();
    });
});
```

**API 請求更新：**
```javascript
// 添加狀態篩選參數（移除 filter_tag）
if (currentStatusFilter && currentStatusFilter !== 'all') {
    url += `&status=${currentStatusFilter}`;
}
```

## 🎯 使用方式

### 在 Manga 列表頁面

1. **訪問頁面**
   - http://127.0.0.1:5000/manga

2. **使用篩選**
   - 點擊「全部」- 顯示所有漫畫
   - 點擊「⭐ 收藏」- 只顯示已收藏的漫畫
   - 點擊「🆕 未審核」- 只顯示未審核的漫畫

3. **結合搜尋**
   - 可以在篩選的基礎上再搜尋
   - 搜尋會在當前篩選的結果中進行

### 在 Gallery 列表頁面

1. **訪問頁面**
   - http://127.0.0.1:5000/gallery

2. **使用篩選**
   - 與 Manga 相同的操作方式
   - 統一的視覺效果

## 🔄 與舊版本的差異

### 移除的功能
- ❌ 基於 `.special` marker 文件的精選篩選
- ❌ `setFilter(filterTag)` 全局函數
- ❌ `currentFilter` 變數（Gallery 中改為 `currentStatusFilter`）
- ❌ `filter_tag` API 參數

### 新增的功能
- ✅ 基於 JSON 的狀態管理
- ✅ 統一的篩選界面
- ✅ `status` API 參數
- ✅ 三種狀態篩選（全部/收藏/未審核）

## 📊 API 請求範例

### 獲取全部漫畫
```
GET /manga/api/list?page=1&per_page=6&skip_chapters=false
```

### 獲取收藏的漫畫
```
GET /manga/api/list?page=1&per_page=6&skip_chapters=false&status=favorite
```

### 獲取未審核的 Gallery
```
GET /gallery/api/list?page=1&per_page=6&status=unreviewed
```

### 結合搜尋和篩選
```
GET /gallery/api/list?page=1&per_page=6&status=favorite&search=關鍵字
```

## 🎨 視覺效果

### 按鈕狀態

**未選中：**
- 淺灰色背景 (#f0f0f0)
- 灰色文字 (#666)
- 灰色邊框 (#ddd)

**懸停：**
- 深灰色背景 (#e0e0e0)
- 紫色邊框 (#667eea)
- 向上移動 2px

**選中（Active）：**
- 紫色漸變背景 (135deg, #667eea → #764ba2)
- 白色文字
- 紫色邊框
- 發光陰影效果

### 響應式設計
- 使用 `flex-wrap: wrap`
- 按鈕在小屏幕上會自動換行
- 保持一致的間距（gap: 10px）

## ✅ 測試檢查表

### 基本功能
- [ ] 頁面載入時「全部」按鈕為 active 狀態
- [ ] 點擊按鈕會切換 active 狀態
- [ ] 只有一個按鈕可以是 active 狀態

### 篩選功能
- [ ] 點擊「全部」顯示所有項目
- [ ] 點擊「收藏」只顯示已收藏的項目
- [ ] 點擊「未審核」只顯示未審核的項目
- [ ] 篩選後頁面重置為第 1 頁

### API 集成
- [ ] 篩選時發送正確的 API 請求
- [ ] API 返回正確的篩選結果
- [ ] 無限滾動在篩選狀態下正常工作

### 搜尋集成
- [ ] 篩選和搜尋可以同時使用
- [ ] 搜尋在當前篩選結果中進行
- [ ] 切換篩選不影響搜尋框內容

### 視覺效果
- [ ] 按鈕樣式正確顯示
- [ ] 懸停效果正常
- [ ] Active 狀態高亮明顯
- [ ] 在不同屏幕尺寸下正常顯示

## 🐛 已知問題和解決方案

### 問題：切換篩選後搜尋結果消失
**原因：** 篩選時重新載入數據
**解決：** 這是預期行為，篩選優先於搜尋

### 問題：無限滾動載入錯誤的數據
**原因：** 滾動載入時未傳遞當前篩選狀態
**解決：** `loadMangas()` 和 `loadWorks()` 會自動使用 `currentFilter`/`currentStatusFilter`

### 問題：按鈕樣式在某些瀏覽器不顯示
**原因：** CSS 兼容性
**解決：** 使用標準 CSS 屬性，避免使用實驗性功能

## 🎉 完成狀態

列表頁面的狀態篩選功能已經**完全實現**！

### 已實現功能
- ✅ Manga 列表篩選
- ✅ Gallery 列表篩選
- ✅ 移除舊的精選機制
- ✅ 統一的 UI 設計
- ✅ 完整的交互邏輯

### 整體狀態管理系統
- ✅ StatusManager 後端
- ✅ API 端點（GET/POST）
- ✅ Reader 頁面收藏按鈕
- ✅ 列表頁面篩選功能
- ✅ 數據持久化（JSON）

**所有功能都已完成並可以使用！** 🎊
