# 列表頁面收藏按鈕功能說明

## 📝 功能概述

在漫畫列表和 Gallery 列表頁面的每個作品卡片上添加了收藏按鈕,讓使用者可以直接在列表頁面快速收藏/取消收藏作品,無需進入閱讀器頁面。

## 🎨 介面設計

### 收藏按鈕位置

收藏按鈕位於每個作品卡片的封面圖片**右上角**:

```
┌─────────────────────┐
│ 封面圖片        [⭐] │
│                     │
│                     │
└─────────────────────┘
  作品標題
```

### 按鈕樣式

- **背景**: 半透明黑色圓形按鈕 `rgba(0, 0, 0, 0.6)`
- **圖示顏色**: 金色 `#ffd700`
- **尺寸**: 40px × 40px 圓形
- **效果**: 
  - 毛玻璃效果 `backdrop-filter: blur(5px)`
  - Hover 時背景變深並放大 1.15 倍
  - 點擊時顯示 loading 狀態 (透明度 0.5)

### 按鈕狀態

- **未收藏**: ☆ (空心星星)
- **已收藏**: ★ (實心星星)

## ⚙️ 功能行為

### 點擊行為

1. **點擊收藏按鈕**: 
   - 阻止事件冒泡 (`event.stopPropagation()`)
   - 不會觸發卡片點擊事件 (不會打開作品)
   - 只執行收藏/取消收藏操作

2. **點擊卡片其他區域**:
   - 正常打開作品/漫畫

### 狀態切換邏輯

與閱讀器頁面的收藏行為完全一致:

- **當前未收藏** → 點擊 → 設為收藏 (★)
- **當前已收藏** → 點擊 → 改為未審核 (☆)

### 自動更新

1. **按鈕即時更新**: 點擊後立即更新按鈕圖示 (☆ ↔ ★)
2. **列表自動刷新**: 
   - 如果在「收藏」篩選頁面取消收藏
   - 300ms 後自動重新載入列表
   - 該作品會從列表中消失

3. **狀態同步**: 
   - 列表頁面設定的收藏狀態
   - 與閱讀器頁面完全同步
   - 資料儲存在同一個 `status.json` 檔案

## 📁 修改的檔案

### CSS 樣式

1. **src/static/css/manga.css**
   - 新增 `.manga-favorite-btn` 樣式
   - 絕對定位在封面右上角
   - 半透明黑色圓形按鈕設計

2. **src/static/css/gallery.css**
   - 新增 `.work-favorite-btn` 樣式
   - 與漫畫頁面樣式一致

### JavaScript 功能

1. **src/static/js/manga/index.js**
   - 修改 `displayMangas()` 函數:
     - 根據 `manga.status` 顯示對應的星星圖示
     - 添加收藏按鈕 HTML
   - 新增 `toggleCardFavorite()` 函數:
     - 處理收藏切換邏輯
     - API 呼叫和狀態更新
     - 列表自動刷新

2. **src/static/js/gallery/index.js**
   - 修改 `displayWorks()` 函數:
     - 根據 `work.status` 顯示對應的星星圖示
     - 添加收藏按鈕 HTML
   - 新增 `toggleCardFavorite()` 函數:
     - 處理收藏切換邏輯
     - API 呼叫和狀態更新
     - 列表自動刷新

## 🎯 使用場景

### 快速收藏

在瀏覽作品列表時:
1. 看到喜歡的作品
2. 直接點擊封面右上角的星星
3. 立即加入收藏,無需進入閱讀器

### 批量管理

在收藏頁面時:
1. 點擊「⭐ 收藏」篩選按鈕
2. 查看所有已收藏的作品
3. 點擊星星取消不想要的收藏
4. 作品自動從列表消失

### 狀態一目了然

- 實心星 ★ = 已收藏
- 空心星 ☆ = 未收藏
- 在「全部」頁面可以快速看到哪些作品已收藏

## 💡 技術細節

### 事件處理

```javascript
onclick="event.stopPropagation(); toggleCardFavorite('${path}', this)"
```

- `event.stopPropagation()`: 防止觸發卡片點擊
- `this`: 傳遞按鈕元素,用於更新 UI

### API 呼叫

```javascript
// 1. 獲取當前狀態
GET /manga/api/status/{mangaPath}
GET /gallery/api/status/{workPath}

// 2. 更新狀態
POST /manga/api/status/{mangaPath}
POST /gallery/api/status/{workPath}
Body: { "status": "favorite" | "unreviewed" }
```

### 狀態更新流程

1. 點擊按鈕 → 添加 loading 狀態
2. 獲取當前狀態 (favorite/unreviewed/reviewed)
3. 切換狀態 (favorite ↔ unreviewed)
4. 發送 POST 請求更新
5. 更新按鈕圖示和 title
6. 更新本地 allMangas/allWorks 陣列
7. 如需要則重新載入列表
8. 移除 loading 狀態

## 🎨 視覺效果

### 按鈕懸浮效果

```css
.manga-favorite-btn:hover {
    background: rgba(0, 0, 0, 0.8);  /* 背景變深 */
    transform: scale(1.15);           /* 放大 1.15 倍 */
}
```

### Loading 狀態

```css
.manga-favorite-btn.loading {
    opacity: 0.5;      /* 半透明 */
    cursor: wait;      /* 等待游標 */
}
```

### 毛玻璃效果

```css
backdrop-filter: blur(5px);  /* 背景模糊 */
```

## ⚠️ 注意事項

1. **點擊區域**: 收藏按鈕有獨立的點擊區域,不會觸發卡片點擊
2. **狀態同步**: 列表頁和閱讀器頁的收藏狀態完全同步
3. **自動刷新**: 在收藏篩選頁取消收藏時,會自動刷新列表
4. **錯誤處理**: API 失敗時會顯示提示訊息
5. **視覺回饋**: 所有操作都有即時的視覺回饋

## 🚀 未來優化建議

1. **批量收藏**: 支援選擇多個作品批量收藏
2. **拖曳排序**: 在收藏頁面支援拖曳調整順序
3. **收藏分類**: 支援建立多個收藏夾
4. **快捷鍵**: 支援鍵盤快捷鍵快速收藏

## 更新時間

2026-01-11
