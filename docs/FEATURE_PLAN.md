# ğŸ“‹ æ¼«ç•«èˆ‡ PIXIV åŠŸèƒ½éœ€æ±‚è¨ˆåŠƒ

## ğŸ¯ éœ€æ±‚æ¦‚è¿°

### æ¼«ç•«æ¨¡çµ„
| åŠŸèƒ½å€å¡Š | éœ€æ±‚æè¿° |
|---------|----------|
| **ä¸»é è¼‰å…¥** | é¦–æ¬¡è¼‰å…¥ 6 å€‹é …ç›®ï¼Œæ»¾å‹•åˆ°åº•éƒ¨ç¹¼çºŒè¼‰å…¥ä¸‹ 6 å€‹ |
| **åœ–å¡é¡¯ç¤º** | å°é¢åœ–ç‰‡ + ä¸‹æ–¹é¡¯ç¤ºç« ç¯€ï¼ˆå­è³‡æ–™å¤¾ï¼‰åˆ—è¡¨ |
| **ç« ç¯€åˆ—è¡¨** | æŒ‰åç¨±æ’åºï¼Œå›ºå®šé«˜åº¦é¡¯ç¤º 5 å€‹ç« ç¯€ï¼Œè¶…éç”¨å·è»¸æ»¾å‹• |
| **Reader** | ä¾åºé¡¯ç¤ºè©²ç« ç¯€æ‰€æœ‰åœ–ç‰‡ï¼ˆä¸€æ¬¡æ€§è¼‰å…¥ï¼‰ |

### PIXIV æ¨¡çµ„
| åŠŸèƒ½å€å¡Š | éœ€æ±‚æè¿° |
|---------|----------|
| **ä¸»é è¼‰å…¥** | é¦–æ¬¡è¼‰å…¥ 6 å€‹é …ç›®ï¼Œæ»¾å‹•åˆ°åº•éƒ¨ç¹¼çºŒè¼‰å…¥ä¸‹ 6 å€‹ |
| **åœ–å¡é¡¯ç¤º** | å°é¢åœ–ç‰‡ + ä¸‹æ–¹é¡¯ç¤ºåœ–ç‰‡æ•¸é‡ |
| **Reader** | åˆå§‹è¼‰å…¥å‰ 3 å¼µåœ–ç‰‡ + ç¸½æ•¸é‡ï¼Œå…¶é¤˜ç”¨ç©ºä½”ä½ç¬¦ï¼Œæ»¾å‹•åˆ°ä½”ä½ç¬¦å†è¼‰å…¥ä¸‹ 3 å¼µï¼ˆæ‡¶åŠ è¼‰ï¼‰ |

---

## ğŸ”§ ä¿®æ”¹æ¸…å–®

### 1. å¾Œç«¯ä¿®æ”¹

#### 1.1 æ¼«ç•« Service (`modules/manga/service.py`)
- [x] `get_manga_list()` - é è¨­ `per_page=6`
- [x] `get_manga_list()` - å¢åŠ  `include_chapters=True` åƒæ•¸ï¼Œå–å¾—ç« ç¯€åˆ—è¡¨

#### 1.2 æ¼«ç•« Routes (`modules/manga/routes.py`)
- [x] `get_list()` - é è¨­ `per_page=6`ï¼Œè¨­å®š `skip_chapters=false`

#### 1.3 PIXIV Service (`modules/pixiv/service.py`)
- [x] `get_pixiv_list()` - é è¨­ `per_page=6`ï¼ˆå·²æ˜¯ï¼‰
- [x] `get_chapter_images_paginated()` - æ”¯æ´ `limit=3` åˆ†é 

#### 1.4 PIXIV Routes (`modules/pixiv/routes.py`)
- [x] `get_list()` - é è¨­ `per_page=6`ï¼ˆå·²æ˜¯ï¼‰
- [x] `get_chapter_images()` - é è¨­ `limit=3`ï¼Œè¿”å›ç¸½æ•¸

---

### 2. å‰ç«¯ä¿®æ”¹

#### 2.1 æ¼«ç•«ä¸»é  JS (`static/js/manga/index.js`)
| é …ç›® | ä¿®æ”¹å…§å®¹ |
|------|----------|
| è¼‰å…¥é‚è¼¯ | `per_page=6`ï¼Œç„¡é™æ»¾å‹•è¼‰å…¥ |
| åœ–å¡é¡¯ç¤º | é¡¯ç¤ºç« ç¯€åˆ—è¡¨ï¼ˆå¸¶æ»¾å‹•ï¼‰ |
| ç« ç¯€åˆ—è¡¨ | å›ºå®šé«˜åº¦ï¼Œé¡¯ç¤º 5 å€‹ç« ç¯€ï¼Œè¶…éæ»¾å‹• |

#### 2.2 æ¼«ç•« CSS (`static/css/manga.css`)
| é …ç›® | ä¿®æ”¹å…§å®¹ |
|------|----------|
| `.chapter-list` | å›ºå®šé«˜åº¦ï¼ˆç´„ 5 å€‹ç« ç¯€ï¼‰ï¼Œoverflow-y: auto |

#### 2.3 PIXIV ä¸»é  JS (æ–°å»º `static/js/pixiv/index.js`)
| é …ç›® | ä¿®æ”¹å…§å®¹ |
|------|----------|
| è¼‰å…¥é‚è¼¯ | `per_page=6`ï¼Œç„¡é™æ»¾å‹•è¼‰å…¥ |
| åœ–å¡é¡¯ç¤º | é¡¯ç¤ºåœ–ç‰‡æ•¸é‡ï¼ˆä¸é¡¯ç¤ºç« ç¯€ï¼‰ |

#### 2.4 PIXIV CSS (æ–°å»º `static/css/pixiv.css`)
| é …ç›® | ä¿®æ”¹å…§å®¹ |
|------|----------|
| `.image-count` | åœ–ç‰‡æ•¸é‡æ¨£å¼ |

#### 2.5 æ¼«ç•« Reader JS (æ–°å»º `static/js/manga/reader.js`)
| é …ç›® | ä¿®æ”¹å…§å®¹ |
|------|----------|
| è¼‰å…¥é‚è¼¯ | ä¸€æ¬¡è¼‰å…¥æ‰€æœ‰åœ–ç‰‡ |
| é¡¯ç¤ºæ–¹å¼ | é †åºé¡¯ç¤º |

#### 2.6 PIXIV Reader JS (æ–°å»º `static/js/pixiv/reader.js`)
| é …ç›® | ä¿®æ”¹å…§å®¹ |
|------|----------|
| åˆå§‹è¼‰å…¥ | å‰ 3 å¼µåœ–ç‰‡ + ç©ºä½”ä½ç¬¦ |
| æ‡¶åŠ è¼‰ | Intersection Observer åµæ¸¬ï¼Œæ¯æ¬¡è¼‰å…¥ 3 å¼µ |
| ç¸½æ•¸é¡¯ç¤º | é¡¯ç¤ºç¸½åœ–ç‰‡æ•¸é‡ |

---

### 3. æ¨¡æ¿ä¿®æ”¹

#### 3.1 PIXIV æ¨¡æ¿ (æ–°å»º)
- `modules/pixiv/templates/pixiv/index.html` - PIXIV ä¸»é æ¨¡æ¿
- `modules/pixiv/templates/pixiv/reader.html` - PIXIV é–±è®€å™¨æ¨¡æ¿

#### 3.2 æ¼«ç•« Reader æ¨¡æ¿ (æ–°å»º)
- `modules/manga/templates/manga/reader.html` - æ¼«ç•«é–±è®€å™¨æ¨¡æ¿

---

## ğŸ“ æª”æ¡ˆçµæ§‹

```
manga_reader/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ manga/
â”‚   â”‚   â”œâ”€â”€ routes.py              âœï¸ ä¿®æ”¹
â”‚   â”‚   â”œâ”€â”€ service.py             âœï¸ ä¿®æ”¹
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â””â”€â”€ manga/
â”‚   â”‚           â”œâ”€â”€ index.html     âœ… å·²å­˜åœ¨
â”‚   â”‚           â””â”€â”€ reader.html    ğŸ†• æ–°å»º
â”‚   â”‚
â”‚   â””â”€â”€ pixiv/
â”‚       â”œâ”€â”€ routes.py              âœï¸ ä¿®æ”¹
â”‚       â”œâ”€â”€ service.py             âœï¸ ä¿®æ”¹
â”‚       â””â”€â”€ templates/
â”‚           â””â”€â”€ pixiv/
â”‚               â”œâ”€â”€ index.html     ğŸ†• æ–°å»º
â”‚               â””â”€â”€ reader.html    ğŸ†• æ–°å»º
â”‚
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ common.css             âœ… å·²å­˜åœ¨
â”‚   â”‚   â”œâ”€â”€ manga.css              âœï¸ ä¿®æ”¹
â”‚   â”‚   â””â”€â”€ pixiv.css              ğŸ†• æ–°å»º
â”‚   â”‚
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ common.js              âœ… å·²å­˜åœ¨
â”‚       â”œâ”€â”€ manga/
â”‚       â”‚   â”œâ”€â”€ index.js           âœï¸ ä¿®æ”¹
â”‚       â”‚   â””â”€â”€ reader.js          ğŸ†• æ–°å»º
â”‚       â””â”€â”€ pixiv/
â”‚           â”œâ”€â”€ index.js           ğŸ†• æ–°å»º
â”‚           â””â”€â”€ reader.js          ğŸ†• æ–°å»º
```

---

## ğŸ”„ è³‡æ–™æµç¨‹

### æ¼«ç•«ä¸»é æµç¨‹
```
[é é¢è¼‰å…¥] 
    â†’ API: GET /manga/api/list?page=1&per_page=6&skip_chapters=false
    â†’ è¿”å›: { mangas: [{name, path, chapters: [...], cover_image}], total, page, total_pages }
    â†’ é¡¯ç¤º 6 å€‹æ¼«ç•«å¡ç‰‡ï¼ˆå«ç« ç¯€åˆ—è¡¨ï¼‰

[æ»¾å‹•åˆ°åº•éƒ¨] 
    â†’ API: GET /manga/api/list?page=2&per_page=6&skip_chapters=false
    â†’ è¿½åŠ  6 å€‹æ¼«ç•«å¡ç‰‡
```

### æ¼«ç•« Reader æµç¨‹
```
[é é¢è¼‰å…¥]
    â†’ API: GET /manga/api/chapter/{chapter_path}
    â†’ è¿”å›: { images: [...], navigation: {...} }
    â†’ ä¸€æ¬¡æ€§é¡¯ç¤ºæ‰€æœ‰åœ–ç‰‡
```

### PIXIV ä¸»é æµç¨‹
```
[é é¢è¼‰å…¥]
    â†’ API: GET /pixiv/api/list?page=1&per_page=6&skip_chapters=true
    â†’ è¿”å›: { mangas: [{name, path, chapter_count (åœ–ç‰‡æ•¸), cover_image}], total, page, total_pages }
    â†’ é¡¯ç¤º 6 å€‹ä½œå“å¡ç‰‡ï¼ˆé¡¯ç¤ºåœ–ç‰‡æ•¸é‡ï¼‰

[æ»¾å‹•åˆ°åº•éƒ¨]
    â†’ API: GET /pixiv/api/list?page=2&per_page=6&skip_chapters=true
    â†’ è¿½åŠ  6 å€‹ä½œå“å¡ç‰‡
```

### PIXIV Reader æµç¨‹
```
[é é¢è¼‰å…¥]
    â†’ API: GET /pixiv/api/chapter/{chapter_path}?limit=3&offset=0
    â†’ è¿”å›: { images: [...], total: N, offset: 0, limit: 3 }
    â†’ é¡¯ç¤ºå‰ 3 å¼µåœ–ç‰‡ + (N-3) å€‹ç©ºä½”ä½ç¬¦
    â†’ é¡¯ç¤º "å…± N å¼µåœ–ç‰‡"

[æ»¾å‹•åˆ°ä½”ä½ç¬¦]
    â†’ Intersection Observer è§¸ç™¼
    â†’ API: GET /pixiv/api/chapter/{chapter_path}?limit=3&offset=3
    â†’ è¼‰å…¥åœ–ç‰‡ï¼Œæ›¿æ›ä½”ä½ç¬¦
```

---

## âš¡ å¯¦ä½œé †åº

1. **Phase 1: å¾Œç«¯ API èª¿æ•´**
   - ä¿®æ”¹æ¼«ç•« service/routesï¼ˆper_page=6, include_chaptersï¼‰
   - ä¿®æ”¹ PIXIV routesï¼ˆç¢ºä¿åˆ†é åƒæ•¸æ­£ç¢ºï¼‰

2. **Phase 2: æ¼«ç•«å‰ç«¯**
   - ä¿®æ”¹ `manga/index.js`ï¼ˆper_page=6, é¡¯ç¤ºç« ç¯€ï¼‰
   - ä¿®æ”¹ `manga.css`ï¼ˆç« ç¯€åˆ—è¡¨å›ºå®šé«˜åº¦ï¼‰
   - æ–°å»º `manga/reader.js` + `manga/reader.html`

3. **Phase 3: PIXIV å‰ç«¯**
   - æ–°å»º `pixiv/index.js` + `pixiv/index.html`
   - æ–°å»º `pixiv.css`
   - æ–°å»º `pixiv/reader.js` + `pixiv/reader.html`ï¼ˆæ‡¶åŠ è¼‰ï¼‰

4. **Phase 4: æ¸¬è©¦é©—è­‰**
   - æ¼«ç•«ä¸»é æ»¾å‹•è¼‰å…¥
   - æ¼«ç•«ç« ç¯€åˆ—è¡¨æ»¾å‹•
   - PIXIV ä¸»é æ»¾å‹•è¼‰å…¥
   - PIXIV Reader æ‡¶åŠ è¼‰

---

## âœ… é©—æ”¶æ¨™æº–

| æ¨¡çµ„ | åŠŸèƒ½ | é©—æ”¶æ¢ä»¶ |
|------|------|----------|
| æ¼«ç•«ä¸»é  | åˆå§‹è¼‰å…¥ | é¡¯ç¤º 6 å€‹æ¼«ç•«å¡ç‰‡ |
| æ¼«ç•«ä¸»é  | ç„¡é™æ»¾å‹• | æ»¾å‹•åˆ°åº•éƒ¨è¼‰å…¥ä¸‹ 6 å€‹ |
| æ¼«ç•«ä¸»é  | ç« ç¯€åˆ—è¡¨ | å›ºå®šé«˜åº¦ï¼Œé¡¯ç¤º 5 å€‹ï¼Œè¶…éå¯æ»¾å‹• |
| æ¼«ç•« Reader | åœ–ç‰‡é¡¯ç¤º | ä¸€æ¬¡é¡¯ç¤ºæ‰€æœ‰åœ–ç‰‡ |
| PIXIV ä¸»é  | åˆå§‹è¼‰å…¥ | é¡¯ç¤º 6 å€‹ä½œå“å¡ç‰‡ |
| PIXIV ä¸»é  | åœ–ç‰‡æ•¸é‡ | å¡ç‰‡ä¸‹æ–¹é¡¯ç¤ºåœ–ç‰‡æ•¸é‡ |
| PIXIV Reader | åˆå§‹è¼‰å…¥ | é¡¯ç¤ºå‰ 3 å¼µ + ä½”ä½ç¬¦ + ç¸½æ•¸ |
| PIXIV Reader | æ‡¶åŠ è¼‰ | æ»¾å‹•åˆ°ä½”ä½ç¬¦è¼‰å…¥ä¸‹ 3 å¼µ |
