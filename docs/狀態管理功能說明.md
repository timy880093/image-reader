# ç‹€æ…‹ç®¡ç†åŠŸèƒ½èªªæ˜

## ğŸ“Œ åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»çµ±æ–°å¢äº†å®Œæ•´çš„ç‹€æ…‹ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å°æ¯å€‹æ¼«ç•«æˆ– Gallery ä½œå“é€²è¡Œç‹€æ…‹æ¨™è¨˜å’Œç¯©é¸ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹é»

### 1. ä¸‰ç¨®ç‹€æ…‹

- **favorite (æ”¶è—)** - â­ é‡è¦æˆ–å–œæ­¡çš„ä½œå“
- **unreviewed (æœªå¯©æ ¸)** - å°šæœªæŸ¥çœ‹çš„æ–°ä½œå“
- **reviewed (å·²å¯©æ ¸)** - å·²ç¶“æŸ¥çœ‹éçš„ä½œå“ï¼ˆé è¨­ç‹€æ…‹ï¼‰

### 2. Reader é é¢æ”¶è—åŠŸèƒ½

#### è¦–è¦ºæ•ˆæœ
- **å¯¦å¿ƒæ˜Ÿæ˜Ÿ (â˜…)** - å·²æ”¶è—
- **ç©ºå¿ƒæ˜Ÿæ˜Ÿ (â˜†)** - æœªæ”¶è—

#### æ“ä½œæ–¹å¼
- é»æ“Šæ˜Ÿæ˜ŸæŒ‰éˆ•å³å¯åˆ‡æ›æ”¶è—ç‹€æ…‹
- æ‡¸åœæ™‚æ˜Ÿæ˜Ÿæœƒæ”¾å¤§ï¼Œæä¾›è¦–è¦ºåé¥‹
- åˆ‡æ›æ™‚æŒ‰éˆ•æœƒé¡¯ç¤ºè¼‰å…¥ç‹€æ…‹ï¼ˆåŠé€æ˜ï¼‰

#### åŠŸèƒ½é‚è¼¯
- å¦‚æœç•¶å‰æœªæ”¶è— â†’ é»æ“Šå¾Œè¨­ç‚ºã€Œæ”¶è—ã€
- å¦‚æœç•¶å‰å·²æ”¶è— â†’ é»æ“Šå¾Œè¨­ç‚ºã€Œå·²å¯©æ ¸ã€

### 3. åˆ—è¡¨é é¢ç¯©é¸åŠŸèƒ½ï¼ˆå¾…å¯¦ç¾ï¼‰

é è¨ˆåœ¨åˆ—è¡¨é é¢æ·»åŠ ä»¥ä¸‹åŠŸèƒ½ï¼š
- ç‹€æ…‹ç¯©é¸æŒ‰éˆ•ï¼šå…¨éƒ¨ã€æ”¶è—ã€æœªå¯©æ ¸
- æ¯å€‹ä½œå“å¡ç‰‡é¡¯ç¤ºç‹€æ…‹å¾½ç« 
- ç‹€æ…‹å¿«é€Ÿåˆ‡æ›æŒ‰éˆ•

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### å¾Œç«¯æ¶æ§‹

#### 1. StatusManager (ç‹€æ…‹ç®¡ç†å™¨)
ä½ç½®ï¼š`src/core/status_manager.py`

**æ ¸å¿ƒæ–¹æ³•ï¼š**
- `get_status(category, path)` - ç²å–æŒ‡å®šé …ç›®çš„ç‹€æ…‹
- `set_status(category, path, status)` - è¨­ç½®é …ç›®ç‹€æ…‹
- `filter_by_status(category, items, status)` - æŒ‰ç‹€æ…‹ç¯©é¸é …ç›®åˆ—è¡¨

**æ•¸æ“šçµæ§‹ï¼š**
```json
{
  "manga": {
    "favorite": ["æ¼«ç•«A", "æ¼«ç•«B"],
    "unreviewed": ["æ¼«ç•«C"]
  },
  "gallery": {
    "favorite": ["ä½œå“X"],
    "unreviewed": ["ä½œå“Y", "ä½œå“Z"]
  }
}
```

**å­˜å„²ä½ç½®ï¼š** `data/status.json`

#### 2. API ç«¯é»

**Manga è·¯ç”±ï¼š**
- `GET /manga/api/status/<manga_path>` - ç²å–æ¼«ç•«ç‹€æ…‹
- `POST /manga/api/status/<manga_path>` - æ›´æ–°æ¼«ç•«ç‹€æ…‹

**Gallery è·¯ç”±ï¼š**
- `GET /gallery/api/status/<gallery_path>` - ç²å–ä½œå“ç‹€æ…‹
- `POST /gallery/api/status/<gallery_path>` - æ›´æ–°ä½œå“ç‹€æ…‹

**è«‹æ±‚æ ¼å¼ï¼ˆPOSTï¼‰ï¼š**
```json
{
  "status": "favorite"  // favorite, unreviewed, reviewed
}
```

**éŸ¿æ‡‰æ ¼å¼ï¼š**
```json
{
  "status": "favorite",
  "path": "æ¼«ç•«åç¨±"
}
```

#### 3. Service å±¤æ•´åˆ

**MangaService.get_manga_list()** æ–°å¢åƒæ•¸ï¼š
- `status_filter` - ç‹€æ…‹ç¯©é¸ï¼ˆfavorite/unreviewed/reviewedï¼‰
- `status_manager` - StatusManager å¯¦ä¾‹

**GalleryService.get_gallery_list()** æ–°å¢åƒæ•¸ï¼š
- `status_filter` - ç‹€æ…‹ç¯©é¸
- `status_manager` - StatusManager å¯¦ä¾‹

### å‰ç«¯å¯¦ç¾

#### 1. Reader é é¢

**HTML çµæ§‹ï¼š**
```html
<button id="favoriteBtn" class="favorite-btn" onclick="toggleFavorite()" title="æ”¶è—">
    <span id="favoriteStar">â˜†</span>
</button>
```

**CSS æ¨£å¼ï¼š**
- é‡‘è‰²æ˜Ÿæ˜Ÿæ•ˆæœï¼ˆ`color: #ffd700;`ï¼‰
- æ‡¸åœæ”¾å¤§å‹•ç•«ï¼ˆ`transform: scale(1.2);`ï¼‰
- è¼‰å…¥ç‹€æ…‹ï¼ˆåŠé€æ˜ï¼‰

**JavaScript æ–¹æ³•ï¼š**
- `loadFavoriteStatus()` - è¼‰å…¥ç•¶å‰æ”¶è—ç‹€æ…‹
- `toggleFavorite()` - åˆ‡æ›æ”¶è—/å–æ¶ˆæ”¶è—
- `updateFavoriteButton(isFavorite)` - æ›´æ–°æŒ‰éˆ•é¡¯ç¤º

#### 2. ç‹€æ…‹åˆ‡æ›æµç¨‹

```javascript
1. ç²å–ç•¶å‰ç‹€æ…‹ (GET /api/status/<path>)
2. åˆ¤æ–·æ˜¯å¦å·²æ”¶è—
3. ç™¼é€æ›´æ–°è«‹æ±‚ (POST /api/status/<path>)
   - å·²æ”¶è— â†’ è¨­ç‚º reviewed
   - æœªæ”¶è— â†’ è¨­ç‚º favorite
4. æ›´æ–° UI é¡¯ç¤ºï¼ˆâ˜… / â˜†ï¼‰
```

## ğŸ“‚ æ–‡ä»¶è®Šæ›´æ¸…å–®

### æ–°å¢æ–‡ä»¶
- âœ… `src/core/status_manager.py` - ç‹€æ…‹ç®¡ç†æ ¸å¿ƒé¡åˆ¥
- âœ… `data/status.json` - ç‹€æ…‹æ•¸æ“šå­˜å„²ï¼ˆè‡ªå‹•å‰µå»ºï¼‰

### ä¿®æ”¹æ–‡ä»¶

**å¾Œç«¯ï¼š**
- âœ… `src/app.py` - åˆå§‹åŒ– StatusManager
- âœ… `src/modules/manga/routes.py` - æ·»åŠ ç‹€æ…‹ API
- âœ… `src/modules/manga/service.py` - æ•´åˆç‹€æ…‹ç¯©é¸
- âœ… `src/modules/gallery/routes.py` - æ·»åŠ ç‹€æ…‹ API
- âœ… `src/modules/gallery/service.py` - æ•´åˆç‹€æ…‹ç¯©é¸ï¼Œç§»é™¤èˆŠçš„ marker æ©Ÿåˆ¶

**å‰ç«¯ï¼ˆMangaï¼‰ï¼š**
- âœ… `src/modules/manga/templates/manga/reader.html` - æ·»åŠ æ”¶è—æŒ‰éˆ•
- âœ… `src/static/js/manga/reader.js` - å¯¦ç¾æ”¶è—åŠŸèƒ½

**å‰ç«¯ï¼ˆGalleryï¼‰ï¼š**
- âœ… `src/modules/gallery/templates/gallery/reader.html` - æ·»åŠ æ”¶è—æŒ‰éˆ•
- âœ… `src/static/js/gallery/reader.js` - å¯¦ç¾æ”¶è—åŠŸèƒ½

**é…ç½®ï¼š**
- âœ… `.gitignore` - æ·»åŠ  `data/` ç›®éŒ„ï¼ˆé¿å…ç‹€æ…‹æ•¸æ“šè¢«æäº¤ï¼‰

### åˆªé™¤å…§å®¹
- âœ… ç§»é™¤ `special_tag_marker` é…ç½®é …
- âœ… ç§»é™¤ `GalleryService.has_marker_file()` æ–¹æ³•
- âœ… ç§»é™¤æ‰€æœ‰ marker æ–‡ä»¶æª¢æŸ¥é‚è¼¯

## ğŸ¨ ä½¿ç”¨ç¯„ä¾‹

### åœ¨ Reader é é¢æ”¶è—ä½œå“

1. æ‰“é–‹ä»»æ„æ¼«ç•«æˆ– Gallery ä½œå“
2. åœ¨å³ä¸Šè§’æ‰¾åˆ°æ˜Ÿæ˜ŸæŒ‰éˆ•ï¼ˆâ˜†ï¼‰
3. é»æ“Šæ˜Ÿæ˜Ÿå³å¯æ”¶è—ï¼ˆè®Šç‚º â˜…ï¼‰
4. å†æ¬¡é»æ“Šå¯å–æ¶ˆæ”¶è—ï¼ˆè®Šå› â˜†ï¼‰

### é€šé API æ“ä½œï¼ˆé€²éšï¼‰

**ç²å–ç‹€æ…‹ï¼š**
```bash
curl http://localhost:8000/manga/api/status/æˆ‘çš„æ¼«ç•«
```

**è¨­ç‚ºæ”¶è—ï¼š**
```bash
curl -X POST http://localhost:8000/manga/api/status/æˆ‘çš„æ¼«ç•« \
  -H "Content-Type: application/json" \
  -d '{"status": "favorite"}'
```

**è¨­ç‚ºæœªå¯©æ ¸ï¼š**
```bash
curl -X POST http://localhost:8000/gallery/api/status/ä½œå“åç¨± \
  -H "Content-Type: application/json" \
  -d '{"status": "unreviewed"}'
```

## ğŸ”œ å¾…å¯¦ç¾åŠŸèƒ½

### åˆ—è¡¨é é¢å¢å¼·ï¼ˆè¦åŠƒä¸­ï¼‰

1. **ç‹€æ…‹ç¯©é¸æŒ‰éˆ•**
   - å…¨éƒ¨ä½œå“
   - åƒ…é¡¯ç¤ºæ”¶è—
   - åƒ…é¡¯ç¤ºæœªå¯©æ ¸

2. **ä½œå“å¡ç‰‡ç‹€æ…‹é¡¯ç¤º**
   - æ”¶è—å¾½ç« ï¼ˆâ­ï¼‰
   - æœªå¯©æ ¸æ¨™è¨˜
   - å¿«é€Ÿæ“ä½œæŒ‰éˆ•

3. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡è¨­ç‚ºå·²å¯©æ ¸
   - æ‰¹é‡æ”¶è—

## ğŸ“ æ³¨æ„äº‹é …

1. **æ•¸æ“šæŒä¹…åŒ–**
   - ç‹€æ…‹æ•¸æ“šå­˜å„²åœ¨ `data/status.json`
   - è©²æ–‡ä»¶å·²åŠ å…¥ `.gitignore`ï¼Œä¸æœƒè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
   - å»ºè­°å®šæœŸå‚™ä»½æ­¤æ–‡ä»¶

2. **é è¨­è¡Œç‚º**
   - æ–°ä½œå“é è¨­ç‚ºã€Œå·²å¯©æ ¸ã€ç‹€æ…‹
   - åªæœ‰æ˜ç¢ºæ¨™è¨˜ç‚º favorite æˆ– unreviewed çš„æ‰æœƒè¨˜éŒ„åœ¨ JSON ä¸­
   - é€™æ¨£å¯ä»¥æ¸›å°‘æ–‡ä»¶å¤§å°

3. **æ€§èƒ½è€ƒé‡**
   - StatusManager ä½¿ç”¨å…§å­˜ç·©å­˜ï¼Œé¿å…é »ç¹è®€å–æ–‡ä»¶
   - åªåœ¨ç‹€æ…‹è®Šæ›´æ™‚æ‰å¯«å…¥ç£ç¢Ÿ
   - ç¯©é¸æ“ä½œåœ¨ Python ç«¯å®Œæˆï¼Œæ•ˆç‡è¼ƒé«˜

4. **å…¼å®¹æ€§**
   - å®Œå…¨ç§»é™¤äº†èˆŠçš„ marker æ–‡ä»¶æ©Ÿåˆ¶
   - èˆŠçš„ `.special` æ¨™è¨˜æ–‡ä»¶ä¸å†ç”Ÿæ•ˆ
   - å»ºè­°æ¸…ç†èˆŠçš„ marker æ–‡ä»¶

## ğŸ› ç–‘é›£æ’è§£

**å•é¡Œï¼šæ”¶è—ç‹€æ…‹ç„¡æ³•ä¿å­˜**
- æª¢æŸ¥ `data/` ç›®éŒ„æ˜¯å¦å­˜åœ¨ä¸”å¯å¯«å…¥
- æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰ API éŒ¯èª¤

**å•é¡Œï¼šæ˜Ÿæ˜ŸæŒ‰éˆ•ç„¡åæ‡‰**
- ç¢ºèª JavaScript æ–‡ä»¶å·²æ­£ç¢ºè¼‰å…¥
- æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°çš„éŒ¯èª¤è¨Šæ¯

**å•é¡Œï¼šåˆ‡æ›ç‹€æ…‹å¾Œä»é¡¯ç¤ºèˆŠç‹€æ…‹**
- æ¸…é™¤ç€è¦½å™¨å¿«å–
- é‡æ–°æ•´ç†é é¢
