# ç« ç¯€æ”¶è—åŠŸèƒ½å¯¦ç¾èªªæ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å¯¦ç¾äº†å°æ¯å€‹æ¼«ç•«ç« ç¯€é€²è¡Œæ”¶è—çš„åŠŸèƒ½ï¼Œä¸¦æ”¯æ´å…¨å±€è¨­å®š [åªé¡¯ç¤ºæ”¶è—] ä¾†ç¯©é¸ç« ç¯€ã€‚

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. ç« ç¯€ç´šåˆ¥æ”¶è—
- âœ… åœ¨ Reader é é¢å¯ä»¥å°æ¯å€‹ç« ç¯€é€²è¡Œæ”¶è—/å–æ¶ˆæ”¶è—
- âœ… æ”¶è—ç‹€æ…‹ä¿å­˜åœ¨ `data/status.json` ä¸­
- âœ… ä½¿ç”¨ç« ç¯€è·¯å¾‘ä½œç‚ºå”¯ä¸€æ¨™è­˜

### 2. å…¨å±€ [åªé¡¯ç¤ºæ”¶è—] è¨­å®š
- âœ… åœ¨æ¼«ç•«ä¸»é æ·»åŠ  [åªé¡¯ç¤ºæ”¶è—] checkbox
- âœ… è¨­å®šä¿å­˜åœ¨ç€è¦½å™¨ localStorage ä¸­
- âœ… è¨­å®šåœ¨ä¸»é å’Œ Reader é é¢ä¹‹é–“å…±äº«

### 3. ä¸»é ç« ç¯€ç¯©é¸
- âœ… å‹¾é¸ [åªé¡¯ç¤ºæ”¶è—] æ™‚ï¼Œåªé¡¯ç¤ºæœ‰æ”¶è—ç« ç¯€çš„æ¸…å–®
- âœ… æœªå‹¾é¸æ™‚ï¼Œé¡¯ç¤ºå…¨éƒ¨ç« ç¯€æ¸…å–®
- âœ… èˆ‡ç¾æœ‰çš„ç‹€æ…‹ç¯©é¸ï¼ˆå…¨éƒ¨/æ”¶è—/å·²å¯©æ ¸/æœªå¯©æ ¸ï¼‰å…±å­˜

### 4. Reader é é¢å°èˆª
- âœ… å‹¾é¸ [åªé¡¯ç¤ºæ”¶è—] æ™‚ï¼Œä¸Šä¸€é /ä¸‹ä¸€é åªåœ¨æ”¶è—çš„ç« ç¯€é–“è·³è½‰
- âœ… æœªå‹¾é¸æ™‚ï¼ŒæŒ‰æ­£å¸¸é †åºå°èˆª
- âœ… æ–¹å‘éµå¿«æ·éµåŒæ­¥æ”¯æ´

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### å¾Œç«¯ä¿®æ”¹

#### 1. `src/modules/manga/service.py`

**ä¿®æ”¹ `get_chapters()` æ–¹æ³•ï¼š**
```python
def get_chapters(self, manga_path, favorite_only=False, status_manager=None):
    """
    ç²å–æ¼«ç•«çš„ç« ç¯€åˆ—è¡¨
    
    Args:
        manga_path: æ¼«ç•«ç›®éŒ„è·¯å¾‘
        favorite_only: æ˜¯å¦åªé¡¯ç¤ºæ”¶è—çš„ç« ç¯€
        status_manager: ç‹€æ…‹ç®¡ç†å™¨å¯¦ä¾‹
    """
    # å¦‚æœå•Ÿç”¨åªé¡¯ç¤ºæ”¶è—ï¼Œå‰‡æª¢æŸ¥ç« ç¯€ç‹€æ…‹
    if favorite_only and status_manager:
        chapter_status = status_manager.get_status('manga', chapter_path)
        if chapter_status != 'favorite':
            continue
```

**ä¿®æ”¹ `get_chapter_navigation()` æ–¹æ³•ï¼š**
```python
def get_chapter_navigation(self, chapter_path, favorite_only=False, status_manager=None):
    """
    ç²å–ç« ç¯€å°èˆªä¿¡æ¯ï¼ˆä¸Šä¸€è©±ã€ä¸‹ä¸€è©±ï¼‰
    
    Args:
        chapter_path: ç« ç¯€è·¯å¾‘ï¼ˆç›¸å°è·¯å¾‘ï¼‰
        favorite_only: æ˜¯å¦åªé¡¯ç¤ºæ”¶è—çš„ç« ç¯€
        status_manager: ç‹€æ…‹ç®¡ç†å™¨å¯¦ä¾‹
    """
    # å¦‚æœå•Ÿç”¨åªé¡¯ç¤ºæ”¶è—ï¼Œå‰‡ç¯©é¸æ”¶è—çš„ç« ç¯€
    if favorite_only and status_manager:
        favorite_chapters = []
        for chapter in all_chapters:
            chapter_status = status_manager.get_status('manga', chapter['path'])
            if chapter_status == 'favorite':
                favorite_chapters.append(chapter)
        
        chapters_to_use = favorite_chapters if favorite_chapters else all_chapters
```

**ä¿®æ”¹ `get_manga_list()` æ–¹æ³•ï¼š**
```python
def get_manga_list(self, page=1, per_page=6, skip_chapters=False, 
                   status_filter=None, status_manager=None, favorite_only=False):
    """
    Args:
        favorite_only: æ˜¯å¦åªé¡¯ç¤ºæ”¶è—çš„ç« ç¯€
    """
    chapters = self.get_chapters(
        manga_dir, 
        favorite_only=favorite_only,
        status_manager=status_manager
    )
```

#### 2. `src/modules/manga/routes.py`

**ä¿®æ”¹ `/api/list` è·¯ç”±ï¼š**
```python
@manga_bp.route('/api/list')
def get_list():
    favorite_only = request.args.get('favorite_only', 'false').lower() == 'true'
    
    result = manga_service.get_manga_list(
        page=page, 
        per_page=per_page, 
        skip_chapters=skip_chapters,
        status_filter=status_filter,
        status_manager=status_manager,
        favorite_only=favorite_only
    )
```

**ä¿®æ”¹ `/api/chapter/<path:chapter_path>` è·¯ç”±ï¼š**
```python
@manga_bp.route('/api/chapter/<path:chapter_path>')
def get_chapter_images(chapter_path):
    favorite_only = request.args.get('favorite_only', 'false').lower() == 'true'
    
    navigation = manga_service.get_chapter_navigation(
        chapter_path, 
        favorite_only=favorite_only,
        status_manager=status_manager
    )
```

### å‰ç«¯ä¿®æ”¹

#### 1. `src/modules/manga/templates/manga/index.html`

**æ·»åŠ  checkboxï¼š**
```html
<div class="filter-bar">
    <button class="filter-btn active" data-status="all">å…¨éƒ¨</button>
    <button class="filter-btn" data-status="favorite">â­ æ”¶è—</button>
    <button class="filter-btn" data-status="reviewed">â˜‘ å·²å¯©æ ¸</button>
    <button class="filter-btn" data-status="unreviewed">ğŸ†• æœªå¯©æ ¸</button>
    <label class="favorite-only-toggle">
        <input type="checkbox" id="favoriteOnlyCheckbox">
        <span>åªé¡¯ç¤ºæ”¶è—ç« ç¯€</span>
    </label>
</div>
```

#### 2. `src/static/js/manga/index.js`

**æ·»åŠ å…¨å±€è®Šæ•¸ï¼š**
```javascript
let favoriteOnly = false;  // åªé¡¯ç¤ºæ”¶è—ç« ç¯€
```

**æ·»åŠ äº‹ä»¶ç›£è½ï¼š**
```javascript
const favoriteOnlyCheckbox = document.getElementById('favoriteOnlyCheckbox');
if (favoriteOnlyCheckbox) {
    favoriteOnlyCheckbox.addEventListener('change', (e) => {
        favoriteOnly = e.target.checked;
        saveFavoriteOnlySetting(favoriteOnly);
        currentPage = 1;
        loadMangas();
    });
}
```

**ä¿®æ”¹ API è«‹æ±‚ï¼š**
```javascript
let url = `${API_PREFIX}/list?page=${page}&per_page=6&skip_chapters=false`;
if (currentFilter && currentFilter !== 'all') {
    url += `&status=${currentFilter}`;
}
if (favoriteOnly) {
    url += `&favorite_only=true`;
}
```

**æ·»åŠ  localStorage æ”¯æ´ï¼š**
```javascript
function saveFavoriteOnlySetting(value) {
    localStorage.setItem('manga_favorite_only', value ? 'true' : 'false');
}

function loadFavoriteOnlySetting() {
    const saved = localStorage.getItem('manga_favorite_only');
    favoriteOnly = saved === 'true';
    const checkbox = document.getElementById('favoriteOnlyCheckbox');
    if (checkbox) {
        checkbox.checked = favoriteOnly;
    }
}
```

#### 3. `src/static/js/manga/reader.js`

**æ·»åŠ å±¬æ€§ï¼š**
```javascript
this.favoriteOnly = false;  // åªé¡¯ç¤ºæ”¶è—ç« ç¯€
```

**è¼‰å…¥è¨­å®šï¼š**
```javascript
loadFavoriteOnlySetting() {
    const saved = localStorage.getItem('manga_favorite_only');
    this.favoriteOnly = saved === 'true';
}
```

**ä¿®æ”¹ API è«‹æ±‚ï¼š**
```javascript
async loadImages() {
    let apiUrl = `${this.apiChapterEndpoint}${encodeURIComponent(this.chapterPath)}`;
    if (this.favoriteOnly) {
        apiUrl += `?favorite_only=true`;
    }
    // ...
}
```

**ä¿®æ”¹æ”¶è—åŠŸèƒ½ä½¿ç”¨ç« ç¯€è·¯å¾‘ï¼š**
```javascript
async loadFavoriteStatus() {
    const chapterPath = this.navigation.current_chapter.path;
    const response = await fetch(`/manga/api/status/${encodeURIComponent(chapterPath)}`);
    // ...
}

async toggleFavorite() {
    const chapterPath = this.navigation.current_chapter.path;
    // ...
}
```

#### 4. `src/static/css/manga.css`

**æ·»åŠ æ¨£å¼ï¼š**
```css
.favorite-only-toggle {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: 15px;
}

.favorite-only-toggle input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: #ffd700;
}
```

## ğŸ“Š æ•¸æ“šçµæ§‹

### status.json ç¯„ä¾‹

```json
{
  "manga": {
    "favorite": [
      "æµ·è³Šç‹/ç¬¬001è©±",
      "æµ·è³Šç‹/ç¬¬005è©±",
      "æµ·è³Šç‹/ç¬¬010è©±",
      "ç«å½±å¿è€…/ç¬¬001è©±"
    ],
    "reviewed": [
      "æµ·è³Šç‹/ç¬¬002è©±",
      "æµ·è³Šç‹/ç¬¬003è©±"
    ]
  },
  "gallery": {
    "favorite": [],
    "reviewed": []
  }
}
```

### localStorage å„²å­˜

```javascript
// éµåï¼šmanga_favorite_only
// å€¼ï¼š'true' æˆ– 'false'
localStorage.getItem('manga_favorite_only')
```

## ğŸ¯ ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1ï¼šæœªå‹¾é¸ [åªé¡¯ç¤ºæ”¶è—]

**ä¸»é ï¼š**
- é¡¯ç¤ºæ‰€æœ‰ç« ç¯€æ¸…å–®
- ä¾‹å¦‚ï¼šç¬¬1è©±ã€ç¬¬2è©±ã€ç¬¬3è©±ã€ç¬¬4è©±ã€ç¬¬5è©±ã€ç¬¬6è©±

**Readerï¼š**
- ç¬¬5è©±çš„ä¸Šä¸€é æ˜¯ç¬¬4è©±
- ç¬¬5è©±çš„ä¸‹ä¸€é æ˜¯ç¬¬6è©±

### å ´æ™¯ 2ï¼šå‹¾é¸ [åªé¡¯ç¤ºæ”¶è—]

**ä¸»é ï¼š**
- åªé¡¯ç¤ºæ”¶è—çš„ç« ç¯€
- ä¾‹å¦‚ï¼šç¬¬1è©±ã€ç¬¬5è©±ã€ç¬¬10è©±ï¼ˆå‡è¨­åªæ”¶è—äº†é€™ä¸‰è©±ï¼‰

**Readerï¼š**
- ç¬¬5è©±çš„ä¸Šä¸€é æ˜¯ç¬¬1è©±
- ç¬¬5è©±çš„ä¸‹ä¸€é æ˜¯ç¬¬10è©±
- æ–¹å‘éµ â† â†’ ä¹ŸæŒ‰æ­¤é‚è¼¯è·³è½‰

## âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### ä¸»é æ¸¬è©¦
- [ ] [åªé¡¯ç¤ºæ”¶è—] checkbox é¡¯ç¤ºæ­£å¸¸
- [ ] å‹¾é¸å¾Œåªé¡¯ç¤ºæœ‰æ”¶è—ç« ç¯€çš„æ¼«ç•«
- [ ] å–æ¶ˆå‹¾é¸å¾Œé¡¯ç¤ºå…¨éƒ¨ç« ç¯€
- [ ] è¨­å®šåœ¨é‡æ–°æ•´ç†å¾Œä¿æŒ
- [ ] èˆ‡ç‹€æ…‹ç¯©é¸æŒ‰éˆ•ï¼ˆå…¨éƒ¨/æ”¶è—/å·²å¯©æ ¸/æœªå¯©æ ¸ï¼‰æ­£å¸¸é…åˆ

### Reader æ¸¬è©¦
- [ ] æ”¶è—æŒ‰éˆ•æ­£å¸¸å·¥ä½œï¼ˆå°ç« ç¯€é€²è¡Œæ”¶è—ï¼‰
- [ ] å‹¾é¸ [åªé¡¯ç¤ºæ”¶è—] æ™‚ï¼Œä¸Šä¸€é /ä¸‹ä¸€é åªåœ¨æ”¶è—ç« ç¯€é–“è·³è½‰
- [ ] æœªå‹¾é¸æ™‚ï¼Œä¸Šä¸€é /ä¸‹ä¸€é æŒ‰æ­£å¸¸é †åºè·³è½‰
- [ ] æ–¹å‘éµ â† â†’ èˆ‡æŒ‰éˆ•è¡Œç‚ºä¸€è‡´
- [ ] æ”¶è—ç‹€æ…‹æ­£ç¢ºé¡¯ç¤ºï¼ˆâ˜… æˆ– â˜†ï¼‰

### æ•¸æ“šæŒä¹…åŒ–æ¸¬è©¦
- [ ] ç« ç¯€æ”¶è—ç‹€æ…‹ä¿å­˜åˆ° status.json
- [ ] [åªé¡¯ç¤ºæ”¶è—] è¨­å®šä¿å­˜åˆ° localStorage
- [ ] é‡å•Ÿæœå‹™å™¨å¾Œæ•¸æ“šä¿æŒ
- [ ] æ¸…é™¤ç€è¦½å™¨æ•¸æ“šå¾Œ localStorage é‡ç½®

## ğŸ› å·²çŸ¥é™åˆ¶

1. **å¦‚æœæ²’æœ‰æ”¶è—ä»»ä½•ç« ç¯€ï¼š**
   - å‹¾é¸ [åªé¡¯ç¤ºæ”¶è—] æ™‚ï¼Œæœƒé¡¯ç¤ºç©ºåˆ—è¡¨
   - Reader å°èˆªæœƒå›é€€åˆ°é¡¯ç¤ºå…¨éƒ¨ç« ç¯€

2. **è·¨æ¼«ç•«å°èˆªï¼š**
   - [åªé¡¯ç¤ºæ”¶è—] åªå½±éŸ¿åŒä¸€æ¼«ç•«å…§çš„ç« ç¯€å°èˆª
   - ä¸æœƒè·¨æ¼«ç•«è·³è½‰

3. **ç·©å­˜å•é¡Œï¼š**
   - ä¿®æ”¹æ”¶è—ç‹€æ…‹å¾Œï¼Œä¸»é åˆ—è¡¨å¯èƒ½éœ€è¦é‡æ–°è¼‰å…¥æ‰èƒ½æ›´æ–°

## ğŸ‰ å®Œæˆç‹€æ…‹

æ‰€æœ‰éœ€æ±‚åŠŸèƒ½å·²å®Œæ•´å¯¦ç¾ï¼š
- âœ… åœ¨ Reader å¯ä»¥å°æ¯å€‹ç« ç¯€é€²è¡Œæ”¶è—/å–æ¶ˆæ”¶è—
- âœ… åœ¨ä¸»é å¯ä»¥å‹¾é¸ [åªé¡¯ç¤ºæ”¶è—] åšå…¨å±€è¨­å®š
- âœ… å‹¾é¸æ™‚åªé¡¯ç¤ºæœ‰æ”¶è—çš„ç« ç¯€æ¸…å–®
- âœ… åœ¨ Reader ä¸­ï¼Œä¸Šä¸€é /ä¸‹ä¸€é æ ¹æ“šè¨­å®šè·³è½‰
- âœ… æ–¹å‘éµå¿«æ·éµåŒæ­¥æ”¯æ´
- âœ… æœªå‹¾é¸æ™‚é¡¯ç¤ºå…¨éƒ¨ç« ç¯€ï¼ŒæŒ‰æ­£å¸¸é †åºå°èˆª

## ğŸ“ å¾ŒçºŒå„ªåŒ–å»ºè­°

1. æ·»åŠ æ‰¹é‡æ”¶è—åŠŸèƒ½
2. æ·»åŠ æ”¶è—ç« ç¯€æ•¸é‡é¡¯ç¤º
3. æ·»åŠ æ”¶è—ç« ç¯€æ’åºåŠŸèƒ½
4. æ·»åŠ åŒ¯å‡º/åŒ¯å…¥æ”¶è—åˆ—è¡¨åŠŸèƒ½
5. æ·»åŠ æ”¶è—ç« ç¯€çš„å¿«é€Ÿè·³è½‰é¸å–®
