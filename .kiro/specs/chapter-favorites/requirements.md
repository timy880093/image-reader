# 需求文件

## 簡介

此功能擴展現有的作品級收藏系統，支援章節級收藏並提供全域篩選功能。使用者可以標記個別章節為收藏，在主頁面切換全域「只顯示收藏」設定，並在閱讀器中無縫瀏覽已收藏的章節。

## 術語表

- **章節（Chapter）**：漫畫作品或 Gallery 作品中的單一集數、期數或資料夾
- **作品（Work）**：包含多個章節的漫畫系列或 Gallery 集合
- **閱讀器（Reader）**：顯示單一章節圖片的頁面
- **主頁面（Main_Page）**：列出所有作品及其章節的索引頁面
- **狀態管理器（Status_Manager）**：管理收藏狀態的後端服務
- **導航（Navigation）**：閱讀器中的上一章/下一章功能
- **全域篩選（Global_Filter）**：跨所有作品只顯示已收藏章節的使用者偏好設定

## 需求

### 需求 1：章節級收藏管理

**使用者故事：** 作為讀者，我想要收藏作品中的個別章節，以便標記我想要重新閱讀的特定集數。

#### 驗收標準

1. WHEN 使用者正在閱讀器中查看章節時，THE 系統 SHALL 顯示該特定章節的收藏切換按鈕
2. WHEN 使用者點擊未收藏章節的收藏按鈕時，THE 系統 SHALL 將該章節標記為已收藏並更新 UI
3. WHEN 使用者點擊已收藏章節的收藏按鈕時，THE 系統 SHALL 移除收藏標記並更新 UI
4. WHEN 章節被收藏時，THE 系統 SHALL 立即將此狀態持久化到儲存空間
5. WHEN 使用者返回先前已收藏的章節時，THE 系統 SHALL 正確顯示已收藏狀態

### 需求 2：全域收藏篩選切換

**使用者故事：** 作為讀者，我想要一個全域切換來只顯示已收藏的章節，以便專注於我在所有作品中選擇的內容。

#### 驗收標準

1. WHEN 使用者訪問主頁面時，THE 系統 SHALL 顯示「只顯示收藏」核取方塊控制項
2. WHEN 使用者勾選「只顯示收藏」核取方塊時，THE 系統 SHALL 持久化此偏好設定
3. WHEN 使用者取消勾選「只顯示收藏」核取方塊時，THE 系統 SHALL 持久化此偏好設定
4. WHEN 頁面重新整理時，THE 系統 SHALL 恢復使用者上次的篩選偏好設定
5. THE 系統 SHALL 在漫畫和 Gallery 模組中全域套用篩選偏好設定

### 需求 3：篩選後的章節顯示

**使用者故事：** 作為讀者，我想要在啟用篩選時只看到已收藏的章節，以便快速存取我選擇的內容。

#### 驗收標準

1. WHEN「只顯示收藏」篩選啟用時，THE 系統 SHALL 在章節列表中只顯示標記為收藏的章節
2. WHEN「只顯示收藏」篩選停用時，THE 系統 SHALL 按原始順序顯示所有章節
3. WHEN 作品沒有已收藏的章節且篩選啟用時，THE 系統 SHALL 隱藏該作品的章節列表
4. WHEN 顯示篩選後的章節時，THE 系統 SHALL 維持原始章節順序
5. WHEN 章節的收藏狀態改變時，THE 系統 SHALL 立即更新篩選顯示而無需重新整理頁面

### 需求 4：智慧閱讀器導航

**使用者故事：** 作為讀者，我想要上一頁/下一頁導航遵循收藏篩選，以便無縫瀏覽我收藏的章節。

#### 驗收標準

1. WHEN「只顯示收藏」篩選啟用且使用者在閱讀器中點擊「下一頁」時，THE 系統 SHALL 導航到下一個已收藏的章節
2. WHEN「只顯示收藏」篩選啟用且使用者在閱讀器中點擊「上一頁」時，THE 系統 SHALL 導航到上一個已收藏的章節
3. WHEN「只顯示收藏」篩選停用時，THE 系統 SHALL 按順序導航到相鄰章節
4. WHEN 使用鍵盤快捷鍵（方向鍵）時，THE 系統 SHALL 遵循當前的篩選狀態
5. WHEN 沒有下一個已收藏章節時，THE 系統 SHALL 停用下一頁導航按鈕
6. WHEN 沒有上一個已收藏章節時，THE 系統 SHALL 停用上一頁導航按鈕
7. IF 已收藏的章節為 1、5 和 10，且使用者正在查看第 5 章，THEN 下一頁 SHALL 導航到第 10 章，上一頁 SHALL 導航到第 1 章
8. IF 篩選停用且章節為 1、2、3、4、5、6，且使用者正在查看第 5 章，THEN 下一頁 SHALL 導航到第 6 章，上一頁 SHALL 導航到第 4 章

### 需求 5：章節收藏狀態持久化

**使用者故事：** 作為系統管理員，我想要可靠地儲存章節收藏，以便使用者偏好永不遺失。

#### 驗收標準

1. WHEN 章節被收藏時，THE 系統 SHALL 將章節路徑儲存在狀態資料結構中
2. WHEN 章節被取消收藏時，THE 系統 SHALL 從狀態資料結構中移除章節路徑
3. WHEN 系統重新啟動時，THE 系統 SHALL 從持久化儲存載入所有章節收藏狀態
4. THE 系統 SHALL 將章節收藏與作品級收藏分開儲存
5. THE 系統 SHALL 在相同的儲存結構中支援漫畫和 Gallery 章節收藏

### 需求 6：章節收藏 API 端點

**使用者故事：** 作為前端開發者，我想要章節收藏的 RESTful API，以便建立響應式 UI 互動。

#### 驗收標準

1. WHEN 對 `/api/chapter-status/<chapter_path>` 發出 GET 請求時，THE 系統 SHALL 返回該章節的收藏狀態
2. WHEN 對 `/api/chapter-status/<chapter_path>` 發出帶有收藏狀態的 POST 請求時，THE 系統 SHALL 更新章節的收藏狀態
3. WHEN 對 `/api/favorite-chapters/<work_path>` 發出 GET 請求時，THE 系統 SHALL 返回該作品所有已收藏章節路徑的列表
4. WHEN API 請求失敗時，THE 系統 SHALL 返回適當的 HTTP 狀態碼和錯誤訊息
5. THE 系統 SHALL 支援漫畫和 Gallery 類別的章節狀態 API

### 需求 7：篩選偏好持久化

**使用者故事：** 作為讀者，我想要記住我的篩選偏好，以便每次訪問時不必重新啟用。

#### 驗收標準

1. WHEN 使用者啟用收藏篩選時，THE 系統 SHALL 將此偏好儲存在瀏覽器本地儲存中
2. WHEN 使用者停用收藏篩選時，THE 系統 SHALL 更新儲存的偏好
3. WHEN 使用者訪問主頁面時，THE 系統 SHALL 從本地儲存讀取篩選偏好
4. WHEN 不存在偏好設定時，THE 系統 SHALL 預設為篩選停用
5. THE 系統 SHALL 為漫畫和 Gallery 儲存獨立的篩選偏好（如果它們有獨立頁面）

### 需求 8：已收藏章節的視覺指示器

**使用者故事：** 作為讀者，我想要在主頁面上看到哪些章節已收藏，以便一眼識別我的選擇。

#### 驗收標準

1. WHEN 章節被收藏時，THE 系統 SHALL 在列表中該章節旁顯示視覺指示器（星星圖示）
2. WHEN 章節未被收藏時，THE 系統 SHALL 顯示空心或無星星指示器
3. WHEN 收藏篩選啟用時，THE 系統 SHALL 視覺上區分啟用的篩選狀態
4. THE 系統 SHALL 在主頁面和閱讀器之間使用一致的圖示
5. WHEN 滑鼠懸停在章節的收藏指示器上時，THE 系統 SHALL 提供視覺回饋
